<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SQL | KurongBlog</title>
<meta name=keywords content="MySQL"><meta name=description content="第一章：数据库基础

数据库：保存有组织的数据的容器（通常是一个文件或一组文件）
数据库软件（DBMS）：MySql，Oracle，MongoDB之类。人们通常用数据库来代替数据库软件的名称
表（table）：某种特定类型数据的结构化清单
模式：关于数据库和表的布局及特性的信息
列（column）：表中的一个字段（该列由字段来唯一标识），所有表都是由一个或多个列组成的，每一列都有自己的数据类型
行（row）：表中的一条数据是由行来存储的
主键（primary key）：唯一标识表中每行的这个列就是主键，应该总是定义主键

关于主键：

任意两行都不具有相同的主键值
每个行都必须有一个主键值


SQL：结构化查询语言
第二章：MySQL简介

略
第三章：使用MySQL



登录数据库
默认主机名：localhost
默认端口：3306


1
2


mysql -u root -p
# 然后输入密码




选择数据库


1


USE database_name;




了解数据库和表


查看所有数据库


1


SHOW DATABASES;




查看一个数据库中的所有表


1


SHOW TABLES;




查看一个表的所有字段


1


SHOW COLUMNS FROM table;


还有一种快捷写法


1


DESCRIBE table;


在返回的列表中可以看到一些建表信息，如字段名，数据类型，键类型，是否为NULL，默认值，其他类型。


其他的show语句


1
2
3
4
5


SHOW GRANTS; # 显示授予用户的安全权限
SHOW ERRORS; # 显示服务器错误
SHOW WARNINGS; # 显示服务器警告信息
SHOW STATUS; # 显示服务器的状态信息
HELP SHOW; # 显示mysql允许的show语句



有一个书写规则：select这样的关键词要大写，表名、列名、数据库名要小写"><meta name=author content="Kurong"><link rel=canonical href=http://localhost:1313/posts/dailydev/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/dailydev/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><meta property="og:title" content="SQL"><meta property="og:description" content="第一章：数据库基础

数据库：保存有组织的数据的容器（通常是一个文件或一组文件）
数据库软件（DBMS）：MySql，Oracle，MongoDB之类。人们通常用数据库来代替数据库软件的名称
表（table）：某种特定类型数据的结构化清单
模式：关于数据库和表的布局及特性的信息
列（column）：表中的一个字段（该列由字段来唯一标识），所有表都是由一个或多个列组成的，每一列都有自己的数据类型
行（row）：表中的一条数据是由行来存储的
主键（primary key）：唯一标识表中每行的这个列就是主键，应该总是定义主键

关于主键：

任意两行都不具有相同的主键值
每个行都必须有一个主键值


SQL：结构化查询语言
第二章：MySQL简介

略
第三章：使用MySQL



登录数据库
默认主机名：localhost
默认端口：3306


1
2


mysql -u root -p
# 然后输入密码




选择数据库


1


USE database_name;




了解数据库和表


查看所有数据库


1


SHOW DATABASES;




查看一个数据库中的所有表


1


SHOW TABLES;




查看一个表的所有字段


1


SHOW COLUMNS FROM table;


还有一种快捷写法


1


DESCRIBE table;


在返回的列表中可以看到一些建表信息，如字段名，数据类型，键类型，是否为NULL，默认值，其他类型。


其他的show语句


1
2
3
4
5


SHOW GRANTS; # 显示授予用户的安全权限
SHOW ERRORS; # 显示服务器错误
SHOW WARNINGS; # 显示服务器警告信息
SHOW STATUS; # 显示服务器的状态信息
HELP SHOW; # 显示mysql允许的show语句



有一个书写规则：select这样的关键词要大写，表名、列名、数据库名要小写"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/dailydev/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-26T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-26T00:00:00+00:00"><meta property="og:site_name" content="KurongBlog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="SQL"><meta name=twitter:description content="第一章：数据库基础

数据库：保存有组织的数据的容器（通常是一个文件或一组文件）
数据库软件（DBMS）：MySql，Oracle，MongoDB之类。人们通常用数据库来代替数据库软件的名称
表（table）：某种特定类型数据的结构化清单
模式：关于数据库和表的布局及特性的信息
列（column）：表中的一个字段（该列由字段来唯一标识），所有表都是由一个或多个列组成的，每一列都有自己的数据类型
行（row）：表中的一条数据是由行来存储的
主键（primary key）：唯一标识表中每行的这个列就是主键，应该总是定义主键

关于主键：

任意两行都不具有相同的主键值
每个行都必须有一个主键值


SQL：结构化查询语言
第二章：MySQL简介

略
第三章：使用MySQL



登录数据库
默认主机名：localhost
默认端口：3306


1
2


mysql -u root -p
# 然后输入密码




选择数据库


1


USE database_name;




了解数据库和表


查看所有数据库


1


SHOW DATABASES;




查看一个数据库中的所有表


1


SHOW TABLES;




查看一个表的所有字段


1


SHOW COLUMNS FROM table;


还有一种快捷写法


1


DESCRIBE table;


在返回的列表中可以看到一些建表信息，如字段名，数据类型，键类型，是否为NULL，默认值，其他类型。


其他的show语句


1
2
3
4
5


SHOW GRANTS; # 显示授予用户的安全权限
SHOW ERRORS; # 显示服务器错误
SHOW WARNINGS; # 显示服务器警告信息
SHOW STATUS; # 显示服务器的状态信息
HELP SHOW; # 显示mysql允许的show语句



有一个书写规则：select这样的关键词要大写，表名、列名、数据库名要小写"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"SQL","item":"http://localhost:1313/posts/dailydev/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SQL","name":"SQL","description":"第一章：数据库基础 数据库：保存有组织的数据的容器（通常是一个文件或一组文件）\n数据库软件（DBMS）：MySql，Oracle，MongoDB之类。人们通常用数据库来代替数据库软件的名称\n表（table）：某种特定类型数据的结构化清单\n模式：关于数据库和表的布局及特性的信息\n列（column）：表中的一个字段（该列由字段来唯一标识），所有表都是由一个或多个列组成的，每一列都有自己的数据类型\n行（row）：表中的一条数据是由行来存储的\n主键（primary key）：唯一标识表中每行的这个列就是主键，应该总是定义主键\n关于主键：\n任意两行都不具有相同的主键值 每个行都必须有一个主键值 SQL：结构化查询语言\n第二章：MySQL简介 略\n第三章：使用MySQL 登录数据库\n默认主机名：localhost\n默认端口：3306\n1 2 mysql -u root -p # 然后输入密码 选择数据库\n1 USE database_name; 了解数据库和表\n查看所有数据库\n1 SHOW DATABASES; 查看一个数据库中的所有表\n1 SHOW TABLES; 查看一个表的所有字段\n1 SHOW COLUMNS FROM table; 还有一种快捷写法\n1 DESCRIBE table; 在返回的列表中可以看到一些建表信息，如字段名，数据类型，键类型，是否为NULL，默认值，其他类型。\n其他的show语句\n1 2 3 4 5 SHOW GRANTS; # 显示授予用户的安全权限 SHOW ERRORS; # 显示服务器错误 SHOW WARNINGS; # 显示服务器警告信息 SHOW STATUS; # 显示服务器的状态信息 HELP SHOW; # 显示mysql允许的show语句 有一个书写规则：select这样的关键词要大写，表名、列名、数据库名要小写\n","keywords":["MySQL"],"articleBody":"第一章：数据库基础 数据库：保存有组织的数据的容器（通常是一个文件或一组文件）\n数据库软件（DBMS）：MySql，Oracle，MongoDB之类。人们通常用数据库来代替数据库软件的名称\n表（table）：某种特定类型数据的结构化清单\n模式：关于数据库和表的布局及特性的信息\n列（column）：表中的一个字段（该列由字段来唯一标识），所有表都是由一个或多个列组成的，每一列都有自己的数据类型\n行（row）：表中的一条数据是由行来存储的\n主键（primary key）：唯一标识表中每行的这个列就是主键，应该总是定义主键\n关于主键：\n任意两行都不具有相同的主键值 每个行都必须有一个主键值 SQL：结构化查询语言\n第二章：MySQL简介 略\n第三章：使用MySQL 登录数据库\n默认主机名：localhost\n默认端口：3306\n1 2 mysql -u root -p # 然后输入密码 选择数据库\n1 USE database_name; 了解数据库和表\n查看所有数据库\n1 SHOW DATABASES; 查看一个数据库中的所有表\n1 SHOW TABLES; 查看一个表的所有字段\n1 SHOW COLUMNS FROM table; 还有一种快捷写法\n1 DESCRIBE table; 在返回的列表中可以看到一些建表信息，如字段名，数据类型，键类型，是否为NULL，默认值，其他类型。\n其他的show语句\n1 2 3 4 5 SHOW GRANTS; # 显示授予用户的安全权限 SHOW ERRORS; # 显示服务器错误 SHOW WARNINGS; # 显示服务器警告信息 SHOW STATUS; # 显示服务器的状态信息 HELP SHOW; # 显示mysql允许的show语句 有一个书写规则：select这样的关键词要大写，表名、列名、数据库名要小写\n第四章：检索数据 检索单个列，多个列，全部的列\n1 2 3 SELECT column FROM table; # 检索单列 SELECT column1, column2 FROM table; # 检索多列 SELECT * FROM table; # 检索全部列，*是通配符，匹配所有列 检索不同的行（所谓‘查重’）\n1 SELECT DISTINCT column FROM table; # 关键词DISTINCT就是查重 限制结果\n1 SELECT column FROM table LIMIT number; # number处为任意正整数，结果受到限制，将返回前number行（从第零行开始算起） 还可以指定从多少行开始检索，检索多少行\n1 SELECT column FROM table LIMIT number1, number2; # 第一个数字是开始位置，第二个是要检索的行数，开始行包括在内 限定表名\n1 SELECT table1.column FROM table2.column; 第五章：排序检索数据 子句：SQL语句由子句构成，一个子句通常由一个关键字和所提供的数据组成，如SELECT语句的FROM子句\n排序数据\n1 SELECT column FROM table ORDER BY column; # 按照字母数字顺序排列，ORDER BY后的column不一定与前面的column相同，可以是其他的列。ORDER BY后的column表示联系此列进行排序 多个列的排序\n1 2 3 SELECT column1, column2 FROM table ORDER BY column1, column2; SELECT column1, column2, column3 FROM table ORDER BY column1, column2; # 需求不同，形式不同 指定排序方向\n1 2 3 4 # 顺序排序（升序） SELECT column FROM table ORDER BY column; # 逆序排序（降序） SELECT column FROM table ORDER BY column DESC; 一个小例子\n1 SELECT column1 FROM table ORDER BY column2 DESC LIMIT 1; # 表示column1按照column2进行降序排序，并返回第一行的结果 第六章：过滤数据 使用WHERE子句\n只检索所需数据需指定搜索条件，而搜索条件放在WHERE后\nORDER BY 需放在 WHERE 后面\nWHERE的子句操作符\n操作符 说明 = 等于 \u003c\u003e 不等于 != 不等于 \u003c 小于 \u003c= 小于等于 \u003e 大于 \u003e= 大于等于 BETWEEN 在指定的两个值之间 检测单个值\n1 2 3 4 SELECT colmun FROM table WHERE colmun = value; SELECT colmun FROM table WHERE colmun \u003c value; SELECT colmun FROM table WHERE colmun != value; # 基本用法有很多种，大体都是这样 范围值检测\n1 2 SELECT column FROM table WHERE column BETWEEN number1 AND number2; # 检测的范围相当于 number1 \u003c= x \u003c= number2 空值NULL检测\n1 SELECT column FROM table WHERE column IS NULL; 第七章：数据过滤 AND，OR操作符\n1 2 3 4 SELECT column FROM table WHERE column=value1 AND column2=value2; # 交集 SELECT column FROM table WHERE column=value1 OR column2=value2; # 并集 # 以上为两个简单实例，仅供参考 # 当过滤条件中出现多个AND和OR，可以加括号来调整运算优先级 IN，NOT操作符\n1 2 3 4 5 6 7 SELECT column FROM table WHERE column IN (value1, value2); # IN用来指示条件范围 SELECT column FROM table WHERE column NOT IN (value1, value2); # 上面的补集 # 下面一个小例子 SELECT column FROM table WHERE column IN (value1, value2); # value2-value1=1 SELECT column FROM table WHERE column=value1 OR column2=value2; # 上面的两个SQL语句效果是相同的 第八章：用通配符进行过滤 LIKE操作符\n使用通配符必须使用LIKE操作符\n部分常用通配符\n%\n%表示任意字符出现任意次数\n%不匹配NULL\n1 2 SELECT column FROM table WHERE column LIKE 'value%'; # 匹配以value开头的任意字符串 SELECT column FROM table WHERE column LIKE '%value%'; # 匹配包含value的任意字符串 匹配任意内容 ```mysql SELECT * FROM table; # 返回表中的所有行 ``` _\n匹配任意单一字符\n1 SELECT column FROM table WHERE column LIKE 'value_'; 第九章：用正则表达式进行搜索 REGEXP操作符\n使用类似LIKE\n正则表达式具体使用\n1 2 SELECT column FROM table WHERE column REGEXP '\\w{5}'; # 一个小例子，所有的使用都与此相似，不多赘述 第十章：创建计算字段 拼接字段\nConcat() 需要一个或多个指定的串\n1 2 SELECT Concat(column1, column2) FROM table; # 将两列的值拼接在一起 SELECT Concat(column1, '(', column2, ')') FROM table; # 大概是这样 column1(column2) 去除空白\nTrim(), Rtrim(), LTrim() 分别为去除两侧空白，右侧空白，左侧空白\n1 SELECT Concat(Trim(column1), '(', column2, ')') FROM table; 使用别名\n直接上例子，一看就懂\n1 SELECT Concat(column1, '(', column2, ')') AS column3 FROM table; 执行算术运算\n操作符 说明 + 加 - 减 * 乘 / 除 1 SELECT column1, column2, column1*colmun2 AS column3 FROM table; # 挺好懂的，具体使用都差不多 第十一章：使用数据处理函数 文本处理函数\n函数 说明 Left() 返回串左侧字符 Length() 返回串的长度 Locate() 找出串的一个子串 Lower() 将串转换为小写 LTrim() 去掉左侧空格 Right() 返回串右侧字符 RTrim() 去掉右侧空格 SubString() 返回子串的字符 Upper() 将串转换为大写 日期和时间处理函数\n函数 说明 AddDate() 增加一个日期（天，周等） AddTime() 增加一个时间（时，分等） CurTime() 返回当前时间 Date() 返回日期时间的日期部分 CurDate() 返回当前日期 DateDiff() 计算两个日期之差 Date_Add() 日期运算函数 Date_Format() 返回一个格式化的日期或时间串 Day() 返回一个日期的天数部分 DayOfWeek() 对于一个日期，返回星期几 Hour() 返回一个时间的小时部分 Minute() 返回一个时间的分钟部分 Month() 返回一个日期的月份部分 Now() 返回当前时间和日期 Second() 返回一个时间的秒部分 Time() 返回一个日期时间的时间部分 Year() 返回一个日期的年份部分 一些例子\n1 2 3 SELECT column FROM table WHERE Date(coulmn) BETWEEN '2008-09-01' AND '2010-09-20'; SELECT column FROM table WHERE Year(coulmn) BETWEEN '2008' AND '2010'; # 大体的使用都与这类似 第十二章：汇总数据 聚集函数\n概念：运行在行组上，就算和返回单个值的函数。\n函数 说明 AVG() 取平均值 MAX() 求最大值 MIN() 求最小值 COUNT() 计数 SUM() 求和 AVG()\n使用略，注意，该函数会忽略空行。\nMAX(), MIN()\n使用略。\nCOUNT()\n使用略，该函数会忽略空行，但是COUNT(*)会计算所有行数。\nSUM()\n使用略。\n聚集不同值\n聚集所有行，指定ALL参数或不给参数。如AVG(ALL column) 聚集不同行，指定DISTINCT参数。如AVG(DISTINCT column) 第十三章：分组数据 创建分组\nGROUP BY子句。按照逻辑进行结果分组。\n使用了聚集函数，且涉及多行，就必须使用GROUP BY。\n例：\n1 2 3 SELECT vend_id, COUNT(*) AS num_prods FROM products GROUP BY vend_id; GROUP BY子句可以包含任意数量的列。 GROUP BY子句中列出的每个列都必须是检索列或有效的表达式（不能是聚集函数）。如果在SELECT中使用了表达式，则GROUP BY子句中也必须用同样的表达式，不能用别名。 除聚集计算语句外，每个列都必须在GROUP BY子句中给出。 GROUP BY子句出现在WHERE之后，ORDER BY之前。 过滤分组\nHAVING子句。和WHERE子句类似，不过HAVING子句是过滤组的，而WHERE子句是过滤行的。\n用到了分组，涉及到分组的行的WHERE都变成了HAVING。\n例：\n1 2 3 4 SELECT vend_id, COUNT(*) AS num_prods FROM products HAVING vend_id \u003e 0 GROUP BY vend_id; 例：\n1 2 3 4 5 SELECT vend_id, COUNT(*) AS num_prods FROM products WHERE price \u003e= 10 HAVING vend_id \u003e 0 GROUP BY vend_id; 分组与排序\nGROUP BY子句的结果无序，常常和ORDER BY一起使用。\n1 2 3 4 5 SELECT order_num, SUM(quanlity * item_price) AS ordertotal FROM orderitems GROUP BY order_num HAVING SUM(quanlity * item_price) \u003e= 50 ORDER BY ordertoal; 第十四章：使用子查询 其实就是嵌套查询。\n看一个例子，后面略：\n1 2 3 4 5 SELECT (SELECT vend_id FROM products WHERE vend_id \u003e 0), COUNT(*) AS num_prods FROM products GROUP BY vend_id; 第十五章：联结表 联结\n联结是一种机制，用在SELECT中关联表。\n创建联结\n例：\n1 2 3 SELECT vend.vend_id, COUNT(*) AS num_prods FROM products WHERE price \u003e= 10; 内联接\n内联接，又称等值联接，基于两个表间的相等测试。\n1 2 3 SELECT vend_name, prod_name, prod_price FROM cendors INNER JOIN products ON vendors.vend_id = products.vend_id; 第十六章：创建高级联结 使用表别名\n1 2 3 SELECT vend.vend_id, COUNT(*) AS num_prods FROM products AS pro WHERE price \u003e= 10; 使用不同类型的联结\n自联结\n1 2 3 4 SELECT p1.prod_id, p1.prod_name FROM products AS p1, products AS p2 WHERE p1.vend_id = p2.vend_id AND p2.prod_id = 'DTNTR'; 使用联结往往比子查询性能更佳。\n自然联结\n相对于内联结返回所有数据，甚至有重复行，自然联结没有重复行。\n但是实际上，用到的所有内部联结都是自然联结，所以重复行的情况可能很难遇到。\n外部联结\n外连接操作以指定表为连接主体，将主体表中不满足连接条件的行一并输出。\n如果左表的某行在右表中没有匹配行，则在相关联的结果集行中右表的所有选择列表列均为空值。\n1 2 3 SELECT student.sno, sname, ssex, sage, sdept, cno, grade FROM student left outer JOIN sc ON student.sno = sc.sno; 左外连接\n以左表为连接主体，返回左表所有匹配行。\n右外连接\n以右表为连接主体，返回右表所有匹配行。\n使用带聚集函数的联结\n1 2 3 SELECT vend_name, COUNT(prod_name), prod_price FROM cendors INNER JOIN products ON vendors.vend_id = products.vend_id; 第十七章：组合查询 组合查询\n执行多个查询，并将结果作为单个查询结果集返回。\n使用Union（并）\n1 2 3 4 5 6 7 SELECT vend_id, prod_id FROM products WHERE prod_price \u003c= 5 UNION SELECT vend_id, prod_id FROM products WHERE vend_id IN (1001, 1002); 将多个查询结果并在一起\nUnion自动去重。如果不想去重可以用UNION ALL。 每个查询中，字段名、表达式、聚集函数必须相同。 对结果排序\n1 2 3 4 5 6 7 8 SELECT vend_id, prod_id FROM products WHERE prod_price \u003c= 5 UNION SELECT vend_id, prod_id FROM products WHERE vend_id IN (1001, 1002) ORDER BY vend_id; 第十八章：全文本搜索 暂略\n第十九章：插入数据 插入单条记录\n1 2 INSERT INTO Student(id, name, sex, grade, age) VALUES ('95020'，'陈冬'，'男'，'IS'，18)； 1 2 3 INSERT INTO Student VALUES ('95020'，'陈冬'，'男'，'IS'，18)； 1 2 3 4 5 6 7 8 2. 插入多条记录 ```sql INSERT INTO Student VALUES ('95020'，'陈冬'，'男'，'IS'，18) ('95030'，'陈冬'，'男'，'IS'，19); 插入检索结果\n1 2 3 INSERT INTO \u003c表名\u003e [(\u003c属性列1\u003e [，\u003c属性列2\u003e… )] 子查询; 1 2 3 4 5 INSERT INTO Deptage(Sdept，Avgage) SELECT Sdept，AVG(Sage) FROM Student GROUP BY Sdept; 第二十章：更新和删除数据 更新数据\n修改某一个元组的值\n1 2 3 UPDATE Student SET Sage = 22 WHERE Sno = '95001'; 修改多个元组的值\n1 2 3 UPDATE Student SET Sage = Sage+1 WHERE Sdept = 'IS'; 带子查询的修改语句\n1 2 3 4 5 6 UPDATE SC SET Grade = 0 WHERE 'CS' = (select Sdept FROM Student WHERE Student.Sno = SC.Sno); 删除数据\n删除某一个元组的值\n1 2 3 DELETE FROM Student WHERE Sno = '95019'; 删除多个元组的值\n1 2 3 DELETE FROM SC WHERE Cno = '2'; 第二十一章：创建和操纵表，创建约束 创建表\n1 2 3 4 5 6 7 8 9 CREATE TABLE Student ( Sno CHAR(5) AUTO_INCREMENT, Sname CHAR(20) NULL, Ssex CHAR(1) NULL, Sage INT NULL, Sdept CHAR(15) NULL, PRIMARY KEY(Sno) ); 主键可多个，叫做联合主键。\nAUTO_INCREMENT:自动填充\n在建表语句的末尾其实还有一句ENGINE = ENGINE_NAME，代表了所选择的引擎。\nMYSQL默认选择MyISAM，性能极佳，支持全文本搜索，但是不支持事务处理。\n还有其他的几个引擎，如InnoDB，支持事务管理，但是不支持全文本搜索；MYMORY，存储在内存，性能极佳，适合做临时表。\n外键不能跨引擎。\n创建约束\n外键\n一个表中的 FOREIGN KEY 指向另一个表中的 PRIMARY KEY。\nFOREIGN KEY 约束用于预防破坏表之间连接的动作。\nFOREIGN KEY 约束也能防止非法数据插入外键列，因为它必须是它指向的那个表中的值之一。\n1 2 3 4 5 6 7 8 9 CREATE TABLE Orders ( Id_O int NOT NULL, OrderNo int NOT NULL, Id_P int, PRIMARY KEY (Id_O), CONSTRAINT fk_PerOrders FOREIGN KEY (Id_P) REFERENCES Persons(Id_P) ) 如果在 “Orders” 表已存在的情况下为 “Id_P” 列创建 FOREIGN KEY 约束，请使用下面的 SQL：\n1 2 3 ALTER TABLE Orders ADD FOREIGN KEY (Id_P) REFERENCES Persons(Id_P) 如果需要命名 FOREIGN KEY 约束，以及为多个列定义 FOREIGN KEY 约束，请使用下面的 SQL 语法：\n1 2 3 4 ALTER TABLE Orders ADD CONSTRAINT fk_PerOrders FOREIGN KEY (Id_P) REFERENCES Persons(Id_P) 如需撤销 FOREIGN KEY 约束，请使用下面的 SQL：\n1 2 ALTER TABLE Orders DROP CONSTRAINT fk_PerOrders Check\nCHECK 约束用于限制列中的值的范围。\n如果对单个列定义 CHECK 约束，那么该列只允许特定的值。\n如果对一个表定义 CHECK 约束，那么此约束会在特定的列中对值进行限制。\n1 2 3 4 5 6 7 8 CREATE TABLE Persons ( Id_P int NOT NULL CHECK (Id_P\u003e0), LastName varchar(255) NOT NULL, FirstName varchar(255), Address varchar(255), City varchar(255) ) IN\n1 2 3 4 5 6 Create table test( Ccity char(15) constraint checcity check( ccity in (‘beijing’,’changchun’) ) Alter table test add constraint checcity check(ccity in (‘beijing’,’changchun’)) LIKE\n1 2 3 Create table test( Cardid char(20) constraint checard check(cardid like(‘[0-9][a-z][0-9][0-9]’) ) BETWEEN AND\n1 2 3 Create table test( cardid int constraint checard check(cardid between 0 and 200) ) 如果需要命名 CHECK 约束，以及为多个列定义 CHECK 约束，请使用下面的 SQL 语法：\n1 2 3 4 5 6 7 8 9 CREATE TABLE Persons ( Id_P int NOT NULL, LastName varchar(255) NOT NULL, FirstName varchar(255), Address varchar(255), City varchar(255), CONSTRAINT chk_Person CHECK (Id_P\u003e0 AND City='Sandnes') ) 如果在表已存在的情况下为 “Id_P” 列创建 CHECK 约束，请使用下面的 SQL：\n1 2 ALTER TABLE Persons ADD CHECK (Id_P\u003e0) 如果需要命名 CHECK 约束，以及为多个列定义 CHECK 约束，请使用下面的 SQL 语法：\n1 2 ALTER TABLE Persons ADD CONSTRAINT chk_Person CHECK (Id_P\u003e0 AND City='Sandnes') 如需撤销 CHECK 约束，请使用下面的 SQL：\n1 2 ALTER TABLE Persons DROP CONSTRAINT chk_Person Default\nDEFAULT 约束用于向列中插入默认值。\n如果没有规定其他的值，那么会将默认值添加到所有的新记录。\n1 2 3 4 5 6 7 8 CREATE TABLE Persons ( Id_P int NOT NULL, LastName varchar(255) NOT NULL, FirstName varchar(255), Address varchar(255), City varchar(255) DEFAULT 'Sandnes' ) 通过使用类似 GETDATE() 这样的函数，DEFAULT 约束也可以用于插入系统值：\n1 2 3 4 5 6 7 CREATE TABLE Orders ( Id_O int NOT NULL, OrderNo int NOT NULL, Id_P int, OrderDate date DEFAULT GETDATE() ) 如果在表已存在的情况下为 “City” 列创建 DEFAULT 约束，请使用下面的 SQL：\n1 2 ALTER TABLE Persons ALTER COLUMN City SET DEFAULT 'SANDNES' 如需撤销 DEFAULT 约束，请使用下面的 SQL：\n1 2 ALTER TABLE Persons ALTER COLUMN City DROP DEFAULT 更新表\n例1：向Student表增加“入学时间”列，其数据类型为日期型。\n1 2 ALTER TABLE Student ADD Scome DATE; 例2：删除属性列。\n1 2 Alter table table_name drop column column_name; 例3：将年龄的数据类型改为整数。\n1 2 ALTER TABLE Student MODIFY Sage INT; 例4：删除学生姓名必须取唯一值的约束。\n1 ALTER TABLE Student DROP unisname; 删除表\n1 DROP TABLE table_name DROP TABLE 不能用于除去由 FOREIGN KEY 约束引用的表。必须先除去引用的 FOREIGN KEY 约束或引用的表。\n表所有者可以除去任何数据库内的表。除去表时，表上的规则或默认值将解除绑定，任何与表关联的约束或触发器将自动除去。如果重新创建表，必须重新绑定适当的规则和默认值，重新创建任何触发器并添加必要的约束。\n重命名表\n1 RENAEM TABLE test1 TO test2; 第二十二章：使用视图 视图\n视图是一个虚拟的表，是一个表中的数据经过某种筛选后的显示方式，视图由一个预定义的查询select语句组成。\n视图的特点：\n视图中的数据并不属于视图本身，而是属于基本的表，对视图可以像表一样进行insert,update,delete操作。 视图不能被修改，表修改或者删除后应该删除视图再重建。 视图的数量没有限制，但是命名不能和视图以及表重复，具有唯一性。 视图可以被嵌套，一个视图中可以嵌套另一个视图。 视图不能索引，不能有相关联的触发器和默认值。 视图可以和表一起使用。 使用视图\n创建视图\n1 CREATE VIEW \u003c视图名\u003e [(\u003c列名\u003e [，\u003c列名\u003e]…)] AS \u003c子查询\u003e 例：\n1 2 3 4 CREATE VIEW IS_Student AS SELECT Sno，Sname，Sage FROM Student WHERE Sdept= 'IS'; 基于视图的视图\n1 2 3 4 5 CREATE VIEW IS_S2 AS SELECT Sno，Sname，Grade --这是一个视图 FROM IS_S1 WHERE Grade \u003e= 90; 1 2 3 4 5 6 7 - 查询视图 ```sql SELECT Sno，Sage FROM IS_Student WHERE Sage \u003c 20; 更新视图\n1 2 3 UPDATE IS_Student SET Sname = '刘辰' WHERE Sno = '95002'; 删除视图\n1 DROP VIEW \u003c视图名\u003e; 第二十三章：使用存储过程 存储过程\n将常用的或很复杂的工作，预先用SQL语句写好并用一个指定的名称存储起来, 那么以后要叫数据库提供与已定义好的存储过程的功能相同的服务时,只需调用execute,即可自动完成命令。\n优点：\n存储过程只在创造时进行编译，以后每次执行存储过程都不需再重新编译，而一般SQL语句每执行一次就编译一次,所以使用存储过程可提高数据库执行速度。 当对数据库进行复杂操作时(如对多个表进行Update,Insert,Query,Delete时)，可将此复杂操作用存储过程封装起来与数据库提供的事务处理结合一起使用。 存储过程可以重复使用,可减少数据库开发人员的工作量。 安全性高,可设定只有某此用户才具有对指定存储过程的使用权。 使用存储过程\n注意每一句sql都要以；结尾。\n简单的创建存储过程\n1 2 3 4 5 CREATE PROCEDURE prcPrintRecruitmentAgencyList() BEGIN SELECT cName, vAddress, cCity, cZip, cPhone, cFax FROM RecruitmentAgencies; END; 运行存储过程\n1 CALL processing_name(@variable); 创建带输入参数的存储过程\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 CREATE PROCEDURE productpricing( OUT pl DECIMAL(8, 2), OUT ph DECIMAL(8, 2), OUT pa DECIMAL(8, 2), ) BEGIN SELECT Min(prod_price) INTO pl FROM products; SELECT Max(prod_price) INTO ph FROM products; SELECT AVG(prod_price) INTO pa FROM products; END; 关键字OUT指出相应的参数用来从存储过程传出一个值返回给调用者。MySQL支持IN（传递给存储过程）、OUT、INOUT（对存储过程传入传出）。\n通过INTO将值传入参数。\nDECIMAL数据类型用于在数据库中存储精确的数值。我们经常将DECIMAL数据类型用于保留准确精确度的列，例如会计系统中的货币数据。\n要定义数据类型为DECIMAL的列，请使用以下语法：\n1 column_name ``DECIMAL``(P,D); 在上面的语法中：\nP是表示有效数字数的精度。 P范围为1〜65。 D是表示小数点后的位数。 D的范围是0~30。MySQL要求D小于或等于(\u003c=)P。 DECIMAL(P，D)表示列可以存储D位小数的P位数。十进制列的实际范围取决于精度和刻度。\n运行上面的例子：\n1 2 3 4 5 CALL productpricing( @pricelow, @pricehigh, @priceaverage ); 如果想检索变量的值：\n1 SELECT @pricelow, @pricehigh, @priceaverage; 另一个例子：\n1 2 3 4 5 6 7 8 9 10 CREATE PROCEDURE ordertotal( IN onumber INT, OUT ototal DECIMAL(8, 2) ) BEGIN SELECT Sum(item_price * quanlity) FROM orderitems WHERE order_num = onumber INTO ototal; END; 运行：\n1 CALL ordertotal(20005, @total); 结果：\n1 SELECT @total; 删除存储过程\n1 DROP PROCEDURE processing_name; 建立智能存储过程\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 DELIMITER $$ CREATE PROCEDURE ordertotal( IN onumber INT, IN taxable BOOLEAN, OUT ototal DECIMAL(8, 2) ) BEGIN DECLARE total DECIMAL(8, 2); DECLARE taxrate INT DEFAULT 6; SELECT Sum(item_price * quanlity) FROM orderitems WHERE order_num = onumber INTO ototal; --Is this taxable? IF taxable THEN SELECT total + (tatal / 100 * taxrate); END IF; SELECT total INTO ototal; END $$ DELIMITER; DELIMITER $$ 声明分隔符为$，而在语句中；还是语句的结尾，而且是存储过程的一部分。要是不加的话，应用会认为；不是存储过程的一部分，会报错。\n检查存储过程\n获得包括何时、有谁创建等详细信息的存储过程列表\n1 2 SHOW PROCEDURE STATUS; SHOW PROCEDURE STATUS LIKE 'SAD';--获得特定的值 第二十四章：语句的分割，流程控制，变量 语句分块\nBEGIN, END用来限定存储过程体，相当于java里的’{ }'\n流程控制\nif，else\n1 2 3 4 5 6 7 8 9 10 CREATE PROCEDURE PRC() BEGIN DECLARE NUMBER INT; SET NUMBER = 10; IF NUMBER \u003e 5 THEN SELECT NUMBER; ELSE SELECT NUMBER; END IF; END while\n使用方法与其他语言类似。\n1 2 3 4 5 6 7 DECLARE i int; SET i = 1 WHILE i \u003c 30 INSERT INTO test (userid) VALUES(i); SET i = i+1; END WHILE go\ngo是用来分开多条sql语句的，一个执行成功后才会执行下一个。\nreturn\n返回值，或结束程序。\n变量的定义与赋值\n定义\n1 DECLARE local_variable data_type; 赋值\n1 SET local_variable = variavle_value; 1 SELECT variavle_value INTO local_variable; 第二十五章：使用游标 游标\n有时需要在检索出来的行中前进或后退一行或多行，这就是使用游标的原因。而游标，就是一个存储在服务器上的数据库查询，它不是一条SELECT语句，而是被检索出来的结果集。\n在MySQL中，游标只能用于存储过程和存储函数。\n使用游标\n几个步骤：\n先定义游标。\n打开游标以供使用。\n对于有数据的游标，根据需要取出数据。\n结束游标时，关闭游标。\n创建游标\n1 2 3 4 5 6 7 8 9 CREATE PROCEDURE processorders() BEGIN DECLARE ordernumbers CURSOR FOR --对下面的查询建立游标 SELECT order_num FROM ordeRs; END; declare asd cursor for select * from table; 用DECLARE来声明游标。\n打开和关闭游标\n1 2 3 4 --打开游标 OPEN CURSOR; --关闭游标 CLOSE CURSOR; 和上一条的例子结合：\n1 2 3 4 5 6 7 8 CREATE PROCEDURE processorders() BEGIN DECLARE ordernumbers CURSOR FOR SELECT order_num FROM ordeRs; OPEN ordernumbers; CLOSE ordernumbers; END; 使用游标数据\n检索单个行\n1 2 3 4 5 6 7 8 9 10 CREATE PROCEDURE processorders() BEGIN DECLARE o INT; DECLARE ordernumbers CURSOR FOR SELECT order_num FROM ordeRs; OPEN ordernumbers; FETCH ordernumbers INTO o; CLOSE ordernumbers; END; 用fetch将第一行数据放入变量o中。\n循环检索行（全部行）\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 CREATE PROCEDURE processorders() BEGIN DECLARE o INT; DECLARE done BOOLEAN DEFAULT 0; DECLARE ordernumbers CURSOR FOR SELECT order_num FROM ordeRs; DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done = 1; OPEN ordernumbers; REPEAT FETCH ordernumbers INTO o; UNTIL done END REPEAT; CLOSE ordernumbers; END; 先是用DECLARE声明了一个CONTINUE HANDLER，条件是SQLSTATE 为'02000’时，SET done = 1。\n然后在REPEAT区块内，重复执行fetch，直到done = 1才会结束重复。\n这样就是循环检索所有行来获得目标记录。\n综合例子\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 CREATE PROCEDURE processorders() BEGIN DECLARE o INT; DECLARE done BOOLEAN DEFAULT 0; DECLARE t DECIMAL(8, 2); DECLARE ordernumbers CURSOR FOR SELECT order_num FROM ordeRs; DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done = 1; CREATE TABLE IF NOT EXISTS ordertotals (order_num INT, total DECIMAL(8, 2)); OPEN ordernumbers; REPEAT FETCH ordernumbers INTO o; --调用存储过程进行计算和检查 CALL ordertotal(o, 1, t); INSERT INTO ordertotals(order_num, total) VALUES (o, t); UNTIL done END REPEAT; CLOSE ordernumbers; END; 第二十六章：使用触发器 触发器\n触发器是MySQL响应以下任意语句而自动执行的一条SQL语句：\nupdate dalete insert 创建触发器\n1 2 3 4 --AFTER 代表这是一个后触发器 CREATE TRIGGER newproduct AFTER INSERT ON products FOR EACH ROW SELECT 'PROduct added'; --FOR EACH ROW 对每一行都起作用 还有before 前触发器。\n删除触发器\n1 DROP TRIGGER newproduct; 使用触发器\nINSERT触发器\n在INSERT触发器代码内，可以引用一个名为NEW的虚拟表，访问被插入的行。\n在前触发器中，NEW中的值可以被更新。\n对于AUTO_INCREMENT列，NEW在INSERT执行前包含0，执行之后包含新的自动生成值。\n1 2 CREATE TRIGGER neworder AFTER INSERT ON orders FOR EACH ROW SELECT NEW.order_num; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u003e BEFORE触发器适用于数据验证和净化，AFTER触发器适用于操作后的输出、处理。 - DELETE触发器 在DELETE触发器代码内，可以引用一个名为OLD的虚拟表，访问被插入的行。 OLD表中的值为只读，不可更新。 ```sql CREATE TRIGGER deleteorder BEFORE DELETE ON orders FOR EACH ROW BEGIN INSERT INTO archive_orders(order_num, order_date) VALUES(OLD.order_num, OLD.order_date); END; UPDATE触发器\n在UPDATE触发器代码内，可以引用一个名为OLD的虚拟表，访问更新前的值。可以引用一个名为NEW的虚拟表，访问更新后的值。\nOLD表中的值为只读，不可更新。\n在BEFORE触发器中，new中的值也可能会被更新。\n1 2 CREATE TRIGGER updatevendor BEFORE UPDATE ON vendors FOR EACH ROW SET NEW.vend_state = Upper(NEW.vend_state); 一些事项\nMySQL中，在触发器内部，无法使用CALL来调用存储过程，只能将代码复制粘贴。 应该用触发器保证数据的一致性。 第二十七章：管理事务处理 事务处理\n用一个例子来了解：\n检查数据库是否存在相应的客户，如果不存在，添加它。 提交客户信息。 检索客户ID。 添加一行到表中。 如果在添加到表中的过程出现故障，回退。 在表中检索新ID。 对于订购的每一项物品，添加新行到另一个表中。 如果在添加到表中的过程出现故障，回退所有添加的行。 提交订单信息。 事务（transaction）：一组SQL语句。\n回退（rollback）：撤销SQL语句的过程。\n提交（commit）：将未存储的SQL语句存储到数据库表。\n保留点（savepoint）：事务处理中设置的临时占位符，可以对它发布回退。\n控制事务处理\nROLLBACK\n1 2 3 4 5 6 SELECT * FROM ordertotals; START TRANSACTION; DELETE FROM ordertotals; SELECT * FROM ordertotals; ROLLBACK; SELECT * FROM ordertotals; drop和create语句不能回退。\nCOMMIT\n1 2 3 4 START TRANSACTION; DELETE FROM orders; COMMIT; --只有delete执行成功才会对表进行更改 SAVEPOINT\n1 2 3 4 5 6 7 8 SELECT * FROM ordertotals; START TRANSACTION; DELETE FROM ordertotals; SAVEPOINT rollback1 SELECT * FROM ordertotals; SAVEPOINT rollback2 ROLLBACK TO rollback1; SELECT * FROM ordertotals; 更改默认的提交行为\n1 SET autocommit = 0; ","wordCount":"2531","inLanguage":"en","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-06-26T00:00:00Z","dateModified":"2024-06-26T00:00:00Z","author":{"@type":"Person","name":"Kurong"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/dailydev/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"},"publisher":{"@type":"Organization","name":"KurongBlog","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/ title=categories><span>categories</span></a></li><li><a href=http://localhost:1313/tags/ title=tags><span>tags</span></a></li><li><a href=http://localhost:1313/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">SQL</h1><div class=post-meta><span title='2024-06-26 00:00:00 +0000 UTC'>June 26, 2024</span>&nbsp;·&nbsp;Kurong&nbsp;|&nbsp;<a href=https://github.com/KurongTohsaka/KurongTohsaka.github.io/content/posts/DailyDev/Mysql%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#第一章数据库基础>第一章：数据库基础</a></li><li><a href=#第二章mysql简介>第二章：MySQL简介</a></li><li><a href=#第三章使用mysql>第三章：使用MySQL</a></li><li><a href=#第四章检索数据>第四章：检索数据</a></li><li><a href=#第五章排序检索数据>第五章：排序检索数据</a></li><li><a href=#第六章过滤数据>第六章：过滤数据</a></li><li><a href=#第七章数据过滤>第七章：数据过滤</a></li><li><a href=#第八章用通配符进行过滤>第八章：用通配符进行过滤</a></li><li><a href=#第九章用正则表达式进行搜索>第九章：用正则表达式进行搜索</a></li><li><a href=#第十章创建计算字段>第十章：创建计算字段</a></li><li><a href=#第十一章使用数据处理函数>第十一章：使用数据处理函数</a></li><li><a href=#第十二章汇总数据>第十二章：汇总数据</a></li><li><a href=#第十三章分组数据>第十三章：分组数据</a></li><li><a href=#第十四章使用子查询>第十四章：使用子查询</a></li><li><a href=#第十五章联结表>第十五章：联结表</a></li><li><a href=#第十六章创建高级联结>第十六章：创建高级联结</a></li><li><a href=#第十七章组合查询>第十七章：组合查询</a></li><li><a href=#第十八章全文本搜索>第十八章：全文本搜索</a></li><li><a href=#第十九章插入数据>第十九章：插入数据</a></li><li><a href=#第二十章更新和删除数据>第二十章：更新和删除数据</a></li><li><a href=#第二十一章创建和操纵表创建约束>第二十一章：创建和操纵表，创建约束</a></li><li><a href=#第二十二章使用视图>第二十二章：使用视图</a></li><li><a href=#第二十三章使用存储过程>第二十三章：使用存储过程</a></li><li><a href=#第二十四章语句的分割流程控制变量>第二十四章：语句的分割，流程控制，变量</a></li><li><a href=#第二十五章使用游标>第二十五章：使用游标</a></li><li><a href=#第二十六章使用触发器>第二十六章：使用触发器</a></li><li><a href=#第二十七章管理事务处理>第二十七章：管理事务处理</a></li></ul></nav></div></details></div><div class=post-content><h2 id=第一章数据库基础>第一章：数据库基础<a hidden class=anchor aria-hidden=true href=#第一章数据库基础>#</a></h2><hr><p>数据库：保存有组织的数据的容器（通常是一个文件或一组文件）</p><p>数据库软件（DBMS）：MySql，Oracle，MongoDB之类。人们通常用数据库来代替数据库软件的名称</p><p>表（table）：某种特定类型数据的结构化清单</p><p>模式：关于数据库和表的布局及特性的信息</p><p>列（column）：表中的一个字段（该列由字段来唯一标识），所有表都是由一个或多个列组成的，每一列都有自己的数据类型</p><p>行（row）：表中的一条数据是由行来存储的</p><p>主键（primary key）：唯一标识表中每行的这个列就是主键，应该总是定义主键</p><blockquote><p>关于主键：</p><ul><li>任意两行都不具有相同的主键值</li><li>每个行都必须有一个主键值</li></ul></blockquote><p>SQL：结构化查询语言</p><h2 id=第二章mysql简介>第二章：MySQL简介<a hidden class=anchor aria-hidden=true href=#第二章mysql简介>#</a></h2><hr><p>略</p><h2 id=第三章使用mysql>第三章：使用MySQL<a hidden class=anchor aria-hidden=true href=#第三章使用mysql>#</a></h2><hr><ol><li><p>登录数据库</p><p>默认主机名：localhost</p><p>默认端口：3306</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mysql -u root -p
</span></span><span class=line><span class=cl><span class=c1># 然后输入密码</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>选择数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>USE</span><span class=w> </span><span class=n>database_name</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>了解数据库和表</p><ul><li><p>查看所有数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=k>DATABASES</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>查看一个数据库中的所有表</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=kp>TABLES</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>查看一个表的所有字段</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=n>COLUMNS</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>还有一种快捷写法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>DESCRIBE</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>在返回的列表中可以看到一些建表信息，如字段名，数据类型，键类型，是否为NULL，默认值，其他类型。</p></li><li><p>其他的show语句</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=n>GRANTS</span><span class=p>;</span><span class=w> </span><span class=c1># 显示授予用户的安全权限
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SHOW</span><span class=w> </span><span class=n>ERRORS</span><span class=p>;</span><span class=w> </span><span class=c1># 显示服务器错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SHOW</span><span class=w> </span><span class=n>WARNINGS</span><span class=p>;</span><span class=w> </span><span class=c1># 显示服务器警告信息
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SHOW</span><span class=w> </span><span class=n>STATUS</span><span class=p>;</span><span class=w> </span><span class=c1># 显示服务器的状态信息
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>HELP</span><span class=w> </span><span class=k>SHOW</span><span class=p>;</span><span class=w> </span><span class=c1># 显示mysql允许的show语句
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>有一个书写规则：select这样的关键词要大写，表名、列名、数据库名要小写</p></blockquote></li></ul></li></ol><h2 id=第四章检索数据>第四章：检索数据<a hidden class=anchor aria-hidden=true href=#第四章检索数据>#</a></h2><hr><ol><li><p>检索单个列，多个列，全部的列</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w> </span><span class=c1># 检索单列
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w> </span><span class=c1># 检索多列
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w> </span><span class=c1># 检索全部列，*是通配符，匹配所有列
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>检索不同的行（所谓‘查重’）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>DISTINCT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w> </span><span class=c1># 关键词DISTINCT就是查重
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>限制结果</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=n>number</span><span class=p>;</span><span class=w> </span><span class=c1># number处为任意正整数，结果受到限制，将返回前number行（从第零行开始算起）
</span></span></span></code></pre></td></tr></table></div></div><p>还可以指定从多少行开始检索，检索多少行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=n>number1</span><span class=p>,</span><span class=w> </span><span class=n>number2</span><span class=p>;</span><span class=w> </span><span class=c1># 第一个数字是开始位置，第二个是要检索的行数，开始行包括在内
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>限定表名</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>table1</span><span class=p>.</span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>table2</span><span class=p>.</span><span class=k>column</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第五章排序检索数据>第五章：排序检索数据<a hidden class=anchor aria-hidden=true href=#第五章排序检索数据>#</a></h2><hr><p>子句：SQL语句由子句构成，一个子句通常由一个关键字和所提供的数据组成，如SELECT语句的FROM子句</p><ol><li><p>排序数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>column</span><span class=p>;</span><span class=w> </span><span class=c1># 按照字母数字顺序排列，ORDER BY后的column不一定与前面的column相同，可以是其他的列。ORDER BY后的column表示联系此列进行排序
</span></span></span></code></pre></td></tr></table></div></div><p>多个列的排序</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=p>,</span><span class=w> </span><span class=n>column3</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1># 需求不同，形式不同
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>指定排序方向</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=c1># 顺序排序（升序）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>column</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1># 逆序排序（降序）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>一个小例子</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>column1</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>column2</span><span class=w> </span><span class=k>DESC</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=c1># 表示column1按照column2进行降序排序，并返回第一行的结果
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第六章过滤数据>第六章：过滤数据<a hidden class=anchor aria-hidden=true href=#第六章过滤数据>#</a></h2><hr><ol><li><p>使用WHERE子句</p><p>只检索所需数据需指定搜索条件，而搜索条件放在WHERE后</p><blockquote><p>ORDER BY 需放在 WHERE 后面</p></blockquote></li><li><p>WHERE的子句操作符</p><table><thead><tr><th style=text-align:left>操作符</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>=</td><td style=text-align:left>等于</td></tr><tr><td style=text-align:left>&lt;></td><td style=text-align:left>不等于</td></tr><tr><td style=text-align:left>!=</td><td style=text-align:left>不等于</td></tr><tr><td style=text-align:left>&lt;</td><td style=text-align:left>小于</td></tr><tr><td style=text-align:left>&lt;=</td><td style=text-align:left>小于等于</td></tr><tr><td style=text-align:left>></td><td style=text-align:left>大于</td></tr><tr><td style=text-align:left>>=</td><td style=text-align:left>大于等于</td></tr><tr><td style=text-align:left>BETWEEN</td><td style=text-align:left>在指定的两个值之间</td></tr></tbody></table><ul><li><p>检测单个值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>colmun</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>colmun</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>colmun</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>colmun</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>colmun</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>colmun</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1># 基本用法有很多种，大体都是这样
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>范围值检测</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=n>number1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>number2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1># 检测的范围相当于 number1 &lt;= x &lt;= number2
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>空值NULL检测</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=no>NULL</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li></ol><h2 id=第七章数据过滤>第七章：数据过滤<a hidden class=anchor aria-hidden=true href=#第七章数据过滤>#</a></h2><hr><ol><li><p>AND，OR操作符</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=o>=</span><span class=n>value1</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>column2</span><span class=o>=</span><span class=n>value2</span><span class=p>;</span><span class=w> </span><span class=c1># 交集
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=o>=</span><span class=n>value1</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>column2</span><span class=o>=</span><span class=n>value2</span><span class=p>;</span><span class=w> </span><span class=c1># 并集
</span></span></span><span class=line><span class=cl><span class=c1># 以上为两个简单实例，仅供参考
</span></span></span><span class=line><span class=cl><span class=c1># 当过滤条件中出现多个AND和OR，可以加括号来调整运算优先级
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>IN，NOT操作符</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=n>value1</span><span class=p>,</span><span class=w> </span><span class=n>value2</span><span class=p>);</span><span class=w> </span><span class=c1># IN用来指示条件范围
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=n>value1</span><span class=p>,</span><span class=w> </span><span class=n>value2</span><span class=p>);</span><span class=w> </span><span class=c1># 上面的补集
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1># 下面一个小例子
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=n>value1</span><span class=p>,</span><span class=w> </span><span class=n>value2</span><span class=p>);</span><span class=w> </span><span class=c1># value2-value1=1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=o>=</span><span class=n>value1</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>column2</span><span class=o>=</span><span class=n>value2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1># 上面的两个SQL语句效果是相同的
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第八章用通配符进行过滤>第八章：用通配符进行过滤<a hidden class=anchor aria-hidden=true href=#第八章用通配符进行过滤>#</a></h2><hr><ol><li><p>LIKE操作符</p><p>使用通配符必须使用LIKE操作符</p></li><li><p>部分常用通配符</p><ul><li><p>%</p><p>%表示任意字符出现任意次数</p><p>%不匹配NULL</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;value%&#39;</span><span class=p>;</span><span class=w> </span><span class=c1># 匹配以value开头的任意字符串
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;%value%&#39;</span><span class=p>;</span><span class=w> </span><span class=c1># 匹配包含value的任意字符串
</span></span></span></code></pre></td></tr></table></div></div></li><li><ul><li></li></ul></li></ul></li></ol><pre><code> 匹配任意内容

 ```mysql
 SELECT * FROM table; # 返回表中的所有行
 ```
</code></pre><ul><li><p>_</p><p>匹配任意单一字符</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;value_&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h2 id=第九章用正则表达式进行搜索>第九章：用正则表达式进行搜索<a hidden class=anchor aria-hidden=true href=#第九章用正则表达式进行搜索>#</a></h2><hr><ol><li><p>REGEXP操作符</p><p>使用类似LIKE</p></li><li><p>正则表达式具体使用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>REGEXP</span><span class=w> </span><span class=s1>&#39;\w{5}&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1># 一个小例子，所有的使用都与此相似，不多赘述
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第十章创建计算字段>第十章：创建计算字段<a hidden class=anchor aria-hidden=true href=#第十章创建计算字段>#</a></h2><hr><ol><li><p>拼接字段</p><p>Concat() 需要一个或多个指定的串</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1>1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=nf>Concat</span><span class=p>(</span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w> </span><span class=c1># 将两列的值拼接在一起
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=nf>Concat</span><span class=p>(</span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;(&#39;</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;)&#39;</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w> </span><span class=c1># 大概是这样 column1(column2)
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>去除空白</p><p>Trim(), Rtrim(), LTrim() 分别为去除两侧空白，右侧空白，左侧空白</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=nf>Concat</span><span class=p>(</span><span class=nf>Trim</span><span class=p>(</span><span class=n>column1</span><span class=p>),</span><span class=w> </span><span class=s1>&#39;(&#39;</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;)&#39;</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>使用别名</p><p>直接上例子，一看就懂</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=nf>Concat</span><span class=p>(</span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;(&#39;</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;)&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>column3</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>执行算术运算</p><table><thead><tr><th style=text-align:left>操作符</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>+</td><td style=text-align:left>加</td></tr><tr><td style=text-align:left>-</td><td style=text-align:left>减</td></tr><tr><td style=text-align:left>*</td><td style=text-align:left>乘</td></tr><tr><td style=text-align:left>/</td><td style=text-align:left>除</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=p>,</span><span class=w> </span><span class=n>column1</span><span class=o>*</span><span class=n>colmun2</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>column3</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w> </span><span class=c1># 挺好懂的，具体使用都差不多
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第十一章使用数据处理函数>第十一章：使用数据处理函数<a hidden class=anchor aria-hidden=true href=#第十一章使用数据处理函数>#</a></h2><hr><ol><li><p>文本处理函数</p><table><thead><tr><th style=text-align:left>函数</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>Left()</td><td style=text-align:left>返回串左侧字符</td></tr><tr><td style=text-align:left>Length()</td><td style=text-align:left>返回串的长度</td></tr><tr><td style=text-align:left>Locate()</td><td style=text-align:left>找出串的一个子串</td></tr><tr><td style=text-align:left>Lower()</td><td style=text-align:left>将串转换为小写</td></tr><tr><td style=text-align:left>LTrim()</td><td style=text-align:left>去掉左侧空格</td></tr><tr><td style=text-align:left>Right()</td><td style=text-align:left>返回串右侧字符</td></tr><tr><td style=text-align:left>RTrim()</td><td style=text-align:left>去掉右侧空格</td></tr><tr><td style=text-align:left>SubString()</td><td style=text-align:left>返回子串的字符</td></tr><tr><td style=text-align:left>Upper()</td><td style=text-align:left>将串转换为大写</td></tr></tbody></table></li><li><p>日期和时间处理函数</p><table><thead><tr><th style=text-align:left>函数</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>AddDate()</td><td style=text-align:left>增加一个日期（天，周等）</td></tr><tr><td style=text-align:left>AddTime()</td><td style=text-align:left>增加一个时间（时，分等）</td></tr><tr><td style=text-align:left>CurTime()</td><td style=text-align:left>返回当前时间</td></tr><tr><td style=text-align:left>Date()</td><td style=text-align:left>返回日期时间的日期部分</td></tr><tr><td style=text-align:left>CurDate()</td><td style=text-align:left>返回当前日期</td></tr><tr><td style=text-align:left>DateDiff()</td><td style=text-align:left>计算两个日期之差</td></tr><tr><td style=text-align:left>Date_Add()</td><td style=text-align:left>日期运算函数</td></tr><tr><td style=text-align:left>Date_Format()</td><td style=text-align:left>返回一个格式化的日期或时间串</td></tr><tr><td style=text-align:left>Day()</td><td style=text-align:left>返回一个日期的天数部分</td></tr><tr><td style=text-align:left>DayOfWeek()</td><td style=text-align:left>对于一个日期，返回星期几</td></tr><tr><td style=text-align:left>Hour()</td><td style=text-align:left>返回一个时间的小时部分</td></tr><tr><td style=text-align:left>Minute()</td><td style=text-align:left>返回一个时间的分钟部分</td></tr><tr><td style=text-align:left>Month()</td><td style=text-align:left>返回一个日期的月份部分</td></tr><tr><td style=text-align:left>Now()</td><td style=text-align:left>返回当前时间和日期</td></tr><tr><td style=text-align:left>Second()</td><td style=text-align:left>返回一个时间的秒部分</td></tr><tr><td style=text-align:left>Time()</td><td style=text-align:left>返回一个日期时间的时间部分</td></tr><tr><td style=text-align:left>Year()</td><td style=text-align:left>返回一个日期的年份部分</td></tr></tbody></table><p>一些例子</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1>1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2>2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=kt>Date</span><span class=p>(</span><span class=n>coulmn</span><span class=p>)</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=s1>&#39;2008-09-01&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=s1>&#39;2010-09-20&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=kt>Year</span><span class=p>(</span><span class=n>coulmn</span><span class=p>)</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=s1>&#39;2008&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=s1>&#39;2010&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1># 大体的使用都与这类似
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第十二章汇总数据>第十二章：汇总数据<a hidden class=anchor aria-hidden=true href=#第十二章汇总数据>#</a></h2><ol><li><p>聚集函数</p><p>概念：运行在行组上，就算和返回单个值的函数。</p><table><thead><tr><th style=text-align:left>函数</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>AVG()</td><td style=text-align:left>取平均值</td></tr><tr><td style=text-align:left>MAX()</td><td style=text-align:left>求最大值</td></tr><tr><td style=text-align:left>MIN()</td><td style=text-align:left>求最小值</td></tr><tr><td style=text-align:left>COUNT()</td><td style=text-align:left>计数</td></tr><tr><td style=text-align:left>SUM()</td><td style=text-align:left>求和</td></tr></tbody></table><ul><li><p>AVG()</p><p>使用略，注意，该函数会忽略空行。</p></li><li><p>MAX(), MIN()</p><p>使用略。</p></li><li><p>COUNT()</p><p>使用略，该函数会忽略空行，但是COUNT(*)会计算所有行数。</p></li><li><p>SUM()</p><p>使用略。</p></li></ul></li><li><p>聚集不同值</p><ul><li>聚集所有行，指定ALL参数或不给参数。如AVG(ALL column)</li><li>聚集不同行，指定DISTINCT参数。如AVG(DISTINCT column)</li></ul></li></ol><h2 id=第十三章分组数据>第十三章：分组数据<a hidden class=anchor aria-hidden=true href=#第十三章分组数据>#</a></h2><hr><ol><li><p>创建分组</p><p>GROUP BY子句。按照逻辑进行结果分组。</p><p>使用了聚集函数，且涉及多行，就必须使用GROUP BY。</p><p>例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1>1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2>2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>vend_id</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>num_prods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>vend_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>GROUP BY子句可以包含任意数量的列。</li><li>GROUP BY子句中列出的每个列都必须是检索列或有效的表达式（不能是聚集函数）。如果在SELECT中使用了表达式，则GROUP BY子句中也必须用同样的表达式，不能用别名。</li><li>除聚集计算语句外，每个列都必须在GROUP BY子句中给出。</li><li>GROUP BY子句出现在WHERE之后，ORDER BY之前。</li></ul></li><li><p>过滤分组</p><p>HAVING子句。和WHERE子句类似，不过HAVING子句是过滤组的，而WHERE子句是过滤行的。</p><p>用到了分组，涉及到分组的行的WHERE都变成了HAVING。</p><p>例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1>1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2>2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3>3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>vend_id</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>num_prods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>HAVING</span><span class=w> </span><span class=n>vend_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>vend_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1>1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2>2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3>3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4>4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>vend_id</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>num_prods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>HAVING</span><span class=w> </span><span class=n>vend_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>vend_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>分组与排序</p><p>GROUP BY子句的结果无序，常常和ORDER BY一起使用。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1>1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2>2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3>3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4>4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>order_num</span><span class=p>,</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>quanlity</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>item_price</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>ordertotal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orderitems</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>order_num</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>HAVING</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>quanlity</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>item_price</span><span class=p>)</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>ordertoal</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第十四章使用子查询>第十四章：使用子查询<a hidden class=anchor aria-hidden=true href=#第十四章使用子查询>#</a></h2><hr><p>其实就是嵌套查询。</p><p>看一个例子，后面略：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1>1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2>2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3>3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4>4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>vend_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>vend_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>),</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>num_prods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>vend_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=第十五章联结表>第十五章：联结表<a hidden class=anchor aria-hidden=true href=#第十五章联结表>#</a></h2><hr><ol><li><p>联结</p><p>联结是一种机制，用在SELECT中关联表。</p></li><li><p>创建联结</p><ul><li><p>例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1>1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2>2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>vend</span><span class=p>.</span><span class=n>vend_id</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>num_prods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>内联接</p><p>内联接，又称等值联接，基于两个表间的相等测试。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1>1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2>2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>vend_name</span><span class=p>,</span><span class=w> </span><span class=n>prod_name</span><span class=p>,</span><span class=w> </span><span class=n>prod_price</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>cendors</span><span class=w> </span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ON</span><span class=w> </span><span class=n>vendors</span><span class=p>.</span><span class=n>vend_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>products</span><span class=p>.</span><span class=n>vend_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li></ol><h2 id=第十六章创建高级联结>第十六章：创建高级联结<a hidden class=anchor aria-hidden=true href=#第十六章创建高级联结>#</a></h2><hr><ol><li><p>使用表别名</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1>1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2>2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>vend</span><span class=p>.</span><span class=n>vend_id</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>num_prods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>pro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>使用不同类型的联结</p><ul><li><p>自联结</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1>1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2>2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3>3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>p1</span><span class=p>.</span><span class=n>prod_id</span><span class=p>,</span><span class=w> </span><span class=n>p1</span><span class=p>.</span><span class=n>prod_name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p1</span><span class=p>,</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>p1</span><span class=p>.</span><span class=n>vend_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p2</span><span class=p>.</span><span class=n>vend_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p2</span><span class=p>.</span><span class=n>prod_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;DTNTR&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>使用联结往往比子查询性能更佳。</p></li><li><p>自然联结</p><p>相对于内联结返回所有数据，甚至有重复行，自然联结没有重复行。</p><p>但是实际上，用到的所有内部联结都是自然联结，所以重复行的情况可能很难遇到。</p></li><li><p>外部联结</p><p>外连接操作以指定表为连接主体，将主体表中不满足连接条件的行一并输出。</p><p>如果左表的某行在右表中没有匹配行，则在相关联的结果集行中右表的所有选择列表列均为空值。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1>1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2>2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>student</span><span class=p>.</span><span class=n>sno</span><span class=p>,</span><span class=w> </span><span class=n>sname</span><span class=p>,</span><span class=w> </span><span class=n>ssex</span><span class=p>,</span><span class=w> </span><span class=n>sage</span><span class=p>,</span><span class=w> </span><span class=n>sdept</span><span class=p>,</span><span class=w> </span><span class=n>cno</span><span class=p>,</span><span class=w> </span><span class=n>grade</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>left</span><span class=w> </span><span class=k>outer</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>sc</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ON</span><span class=w> </span><span class=n>student</span><span class=p>.</span><span class=n>sno</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sc</span><span class=p>.</span><span class=n>sno</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><p>左外连接</p><p>以左表为连接主体，返回左表所有匹配行。</p></li><li><p>右外连接</p><p>以右表为连接主体，返回右表所有匹配行。</p></li></ul></li></ul></li><li><p>使用带聚集函数的联结</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1>1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2>2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>vend_name</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=n>prod_name</span><span class=p>),</span><span class=w> </span><span class=n>prod_price</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>cendors</span><span class=w> </span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ON</span><span class=w> </span><span class=n>vendors</span><span class=p>.</span><span class=n>vend_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>products</span><span class=p>.</span><span class=n>vend_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第十七章组合查询>第十七章：组合查询<a hidden class=anchor aria-hidden=true href=#第十七章组合查询>#</a></h2><hr><ol><li><p>组合查询</p><p>执行多个查询，并将结果作为单个查询结果集返回。</p></li><li><p>使用Union（并）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1>1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2>2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3>3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4>4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5>5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6>6</a>
</span><span class=lnt id=hl-40-7><a class=lnlinks href=#hl-40-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>vend_id</span><span class=p>,</span><span class=w> </span><span class=n>prod_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>prod_price</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UNION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>vend_id</span><span class=p>,</span><span class=w> </span><span class=n>prod_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>vend_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=mi>1001</span><span class=p>,</span><span class=w> </span><span class=mi>1002</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>将多个查询结果并在一起</p></blockquote><ul><li>Union自动去重。如果不想去重可以用UNION ALL。</li><li>每个查询中，字段名、表达式、聚集函数必须相同。</li></ul></li><li><p>对结果排序</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1>1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2>2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3>3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4>4</a>
</span><span class=lnt id=hl-41-5><a class=lnlinks href=#hl-41-5>5</a>
</span><span class=lnt id=hl-41-6><a class=lnlinks href=#hl-41-6>6</a>
</span><span class=lnt id=hl-41-7><a class=lnlinks href=#hl-41-7>7</a>
</span><span class=lnt id=hl-41-8><a class=lnlinks href=#hl-41-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>vend_id</span><span class=p>,</span><span class=w> </span><span class=n>prod_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>prod_price</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UNION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>vend_id</span><span class=p>,</span><span class=w> </span><span class=n>prod_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>vend_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=mi>1001</span><span class=p>,</span><span class=w> </span><span class=mi>1002</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>vend_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第十八章全文本搜索>第十八章：全文本搜索<a hidden class=anchor aria-hidden=true href=#第十八章全文本搜索>#</a></h2><p>暂略</p><h2 id=第十九章插入数据>第十九章：插入数据<a hidden class=anchor aria-hidden=true href=#第十九章插入数据>#</a></h2><ol><li><p>插入单条记录</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1>1</a>
</span><span class=lnt id=hl-42-2><a class=lnlinks href=#hl-42-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>Student</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>sex</span><span class=p>,</span><span class=w> </span><span class=n>grade</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;95020&#39;</span><span class=err>，</span><span class=s1>&#39;陈冬&#39;</span><span class=err>，</span><span class=s1>&#39;男&#39;</span><span class=err>，</span><span class=s1>&#39;IS&#39;</span><span class=err>，</span><span class=mi>18</span><span class=p>)</span><span class=err>；</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1>1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2>2</a>
</span><span class=lnt id=hl-43-3><a class=lnlinks href=#hl-43-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INTO</span><span class=w> </span><span class=n>Student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;95020&#39;</span><span class=err>，</span><span class=s1>&#39;陈冬&#39;</span><span class=err>，</span><span class=s1>&#39;男&#39;</span><span class=err>，</span><span class=s1>&#39;IS&#39;</span><span class=err>，</span><span class=mi>18</span><span class=p>)</span><span class=err>；</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1>1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2>2</a>
</span><span class=lnt id=hl-44-3><a class=lnlinks href=#hl-44-3>3</a>
</span><span class=lnt id=hl-44-4><a class=lnlinks href=#hl-44-4>4</a>
</span><span class=lnt id=hl-44-5><a class=lnlinks href=#hl-44-5>5</a>
</span><span class=lnt id=hl-44-6><a class=lnlinks href=#hl-44-6>6</a>
</span><span class=lnt id=hl-44-7><a class=lnlinks href=#hl-44-7>7</a>
</span><span class=lnt id=hl-44-8><a class=lnlinks href=#hl-44-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>2. 插入多条记录
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   ```sql
</span></span><span class=line><span class=cl>   INSERT
</span></span><span class=line><span class=cl>   INTO Student
</span></span><span class=line><span class=cl>   VALUES (&#39;95020&#39;，&#39;陈冬&#39;，&#39;男&#39;，&#39;IS&#39;，18)
</span></span><span class=line><span class=cl>   (&#39;95030&#39;，&#39;陈冬&#39;，&#39;男&#39;，&#39;IS&#39;，19);
</span></span></code></pre></td></tr></table></div></div><ol start=3><li><p>插入检索结果</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-45-1><a class=lnlinks href=#hl-45-1>1</a>
</span><span class=lnt id=hl-45-2><a class=lnlinks href=#hl-45-2>2</a>
</span><span class=lnt id=hl-45-3><a class=lnlinks href=#hl-45-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INTO</span><span class=w> </span><span class=o>&lt;</span><span class=err>表名</span><span class=o>&gt;</span><span class=w>  </span><span class=p>[(</span><span class=o>&lt;</span><span class=err>属性列</span><span class=mi>1</span><span class=o>&gt;</span><span class=w> </span><span class=p>[</span><span class=err>，</span><span class=o>&lt;</span><span class=err>属性列</span><span class=mi>2</span><span class=o>&gt;</span><span class=err>…</span><span class=w>  </span><span class=p>)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>子查询</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-46-1><a class=lnlinks href=#hl-46-1>1</a>
</span><span class=lnt id=hl-46-2><a class=lnlinks href=#hl-46-2>2</a>
</span><span class=lnt id=hl-46-3><a class=lnlinks href=#hl-46-3>3</a>
</span><span class=lnt id=hl-46-4><a class=lnlinks href=#hl-46-4>4</a>
</span><span class=lnt id=hl-46-5><a class=lnlinks href=#hl-46-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INTO</span><span class=w> </span><span class=n>Deptage</span><span class=p>(</span><span class=n>Sdept</span><span class=err>，</span><span class=n>Avgage</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>Sdept</span><span class=err>，</span><span class=k>AVG</span><span class=p>(</span><span class=n>Sage</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>Sdept</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第二十章更新和删除数据>第二十章：更新和删除数据<a hidden class=anchor aria-hidden=true href=#第二十章更新和删除数据>#</a></h2><ol><li><p>更新数据</p><ul><li><p>修改某一个元组的值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-47-1><a class=lnlinks href=#hl-47-1>1</a>
</span><span class=lnt id=hl-47-2><a class=lnlinks href=#hl-47-2>2</a>
</span><span class=lnt id=hl-47-3><a class=lnlinks href=#hl-47-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UPDATE</span><span class=w> </span><span class=n>Student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>Sage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>22</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>Sno</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;95001&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>修改多个元组的值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-48-1><a class=lnlinks href=#hl-48-1>1</a>
</span><span class=lnt id=hl-48-2><a class=lnlinks href=#hl-48-2>2</a>
</span><span class=lnt id=hl-48-3><a class=lnlinks href=#hl-48-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UPDATE</span><span class=w> </span><span class=n>Student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>Sage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Sage</span><span class=o>+</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>Sdept</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;IS&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>带子查询的修改语句</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1>1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2>2</a>
</span><span class=lnt id=hl-49-3><a class=lnlinks href=#hl-49-3>3</a>
</span><span class=lnt id=hl-49-4><a class=lnlinks href=#hl-49-4>4</a>
</span><span class=lnt id=hl-49-5><a class=lnlinks href=#hl-49-5>5</a>
</span><span class=lnt id=hl-49-6><a class=lnlinks href=#hl-49-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UPDATE</span><span class=w> </span><span class=n>SC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>Grade</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=s1>&#39;CS&#39;</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>Sdept</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>Student</span><span class=p>.</span><span class=n>Sno</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SC</span><span class=p>.</span><span class=n>Sno</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p>删除数据</p><ul><li><p>删除某一个元组的值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-50-1><a class=lnlinks href=#hl-50-1>1</a>
</span><span class=lnt id=hl-50-2><a class=lnlinks href=#hl-50-2>2</a>
</span><span class=lnt id=hl-50-3><a class=lnlinks href=#hl-50-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DELETE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>Sno</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;95019&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>删除多个元组的值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-51-1><a class=lnlinks href=#hl-51-1>1</a>
</span><span class=lnt id=hl-51-2><a class=lnlinks href=#hl-51-2>2</a>
</span><span class=lnt id=hl-51-3><a class=lnlinks href=#hl-51-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DELETE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>SC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>Cno</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li></ol><h2 id=第二十一章创建和操纵表创建约束>第二十一章：创建和操纵表，创建约束<a hidden class=anchor aria-hidden=true href=#第二十一章创建和操纵表创建约束>#</a></h2><ol><li><p>创建表</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-52-1><a class=lnlinks href=#hl-52-1>1</a>
</span><span class=lnt id=hl-52-2><a class=lnlinks href=#hl-52-2>2</a>
</span><span class=lnt id=hl-52-3><a class=lnlinks href=#hl-52-3>3</a>
</span><span class=lnt id=hl-52-4><a class=lnlinks href=#hl-52-4>4</a>
</span><span class=lnt id=hl-52-5><a class=lnlinks href=#hl-52-5>5</a>
</span><span class=lnt id=hl-52-6><a class=lnlinks href=#hl-52-6>6</a>
</span><span class=lnt id=hl-52-7><a class=lnlinks href=#hl-52-7>7</a>
</span><span class=lnt id=hl-52-8><a class=lnlinks href=#hl-52-8>8</a>
</span><span class=lnt id=hl-52-9><a class=lnlinks href=#hl-52-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Sno</span><span class=w> </span><span class=nb>CHAR</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Sname</span><span class=w> </span><span class=nb>CHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>       
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Ssex</span><span class=w> </span><span class=nb>CHAR</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Sage</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Sdept</span><span class=w> </span><span class=nb>CHAR</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>Sno</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w> 
</span></span></span></code></pre></td></tr></table></div></div><p>主键可多个，叫做联合主键。</p><blockquote><p>AUTO_INCREMENT:自动填充</p></blockquote><p>在建表语句的末尾其实还有一句<code>ENGINE = ENGINE_NAME</code>，代表了所选择的引擎。</p><p>MYSQL默认选择MyISAM，性能极佳，支持全文本搜索，但是不支持事务处理。</p><p>还有其他的几个引擎，如InnoDB，支持事务管理，但是不支持全文本搜索；MYMORY，存储在内存，性能极佳，适合做临时表。</p><blockquote><p>外键不能跨引擎。</p></blockquote></li><li><p>创建约束</p><ul><li><p>外键</p><p>一个表中的 FOREIGN KEY 指向另一个表中的 PRIMARY KEY。</p><p>FOREIGN KEY 约束用于预防破坏表之间连接的动作。</p><p>FOREIGN KEY 约束也能防止非法数据插入外键列，因为它必须是它指向的那个表中的值之一。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-53-1><a class=lnlinks href=#hl-53-1>1</a>
</span><span class=lnt id=hl-53-2><a class=lnlinks href=#hl-53-2>2</a>
</span><span class=lnt id=hl-53-3><a class=lnlinks href=#hl-53-3>3</a>
</span><span class=lnt id=hl-53-4><a class=lnlinks href=#hl-53-4>4</a>
</span><span class=lnt id=hl-53-5><a class=lnlinks href=#hl-53-5>5</a>
</span><span class=lnt id=hl-53-6><a class=lnlinks href=#hl-53-6>6</a>
</span><span class=lnt id=hl-53-7><a class=lnlinks href=#hl-53-7>7</a>
</span><span class=lnt id=hl-53-8><a class=lnlinks href=#hl-53-8>8</a>
</span><span class=lnt id=hl-53-9><a class=lnlinks href=#hl-53-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Id_O</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>OrderNo</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Id_P</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>Id_O</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>fk_PerOrders</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>Id_P</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>REFERENCES</span><span class=w> </span><span class=n>Persons</span><span class=p>(</span><span class=n>Id_P</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果在 &ldquo;Orders&rdquo; 表已存在的情况下为 &ldquo;Id_P&rdquo; 列创建 FOREIGN KEY 约束，请使用下面的 SQL：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-54-1><a class=lnlinks href=#hl-54-1>1</a>
</span><span class=lnt id=hl-54-2><a class=lnlinks href=#hl-54-2>2</a>
</span><span class=lnt id=hl-54-3><a class=lnlinks href=#hl-54-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ADD</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>Id_P</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>REFERENCES</span><span class=w> </span><span class=n>Persons</span><span class=p>(</span><span class=n>Id_P</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果需要命名 FOREIGN KEY 约束，以及为多个列定义 FOREIGN KEY 约束，请使用下面的 SQL 语法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-55-1><a class=lnlinks href=#hl-55-1>1</a>
</span><span class=lnt id=hl-55-2><a class=lnlinks href=#hl-55-2>2</a>
</span><span class=lnt id=hl-55-3><a class=lnlinks href=#hl-55-3>3</a>
</span><span class=lnt id=hl-55-4><a class=lnlinks href=#hl-55-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ADD</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>fk_PerOrders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>Id_P</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>REFERENCES</span><span class=w> </span><span class=n>Persons</span><span class=p>(</span><span class=n>Id_P</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如需撤销 FOREIGN KEY 约束，请使用下面的 SQL：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-56-1><a class=lnlinks href=#hl-56-1>1</a>
</span><span class=lnt id=hl-56-2><a class=lnlinks href=#hl-56-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DROP</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>fk_PerOrders</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Check</p><p>CHECK 约束用于限制列中的值的范围。</p><p>如果对单个列定义 CHECK 约束，那么该列只允许特定的值。</p><p>如果对一个表定义 CHECK 约束，那么此约束会在特定的列中对值进行限制。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-57-1><a class=lnlinks href=#hl-57-1>1</a>
</span><span class=lnt id=hl-57-2><a class=lnlinks href=#hl-57-2>2</a>
</span><span class=lnt id=hl-57-3><a class=lnlinks href=#hl-57-3>3</a>
</span><span class=lnt id=hl-57-4><a class=lnlinks href=#hl-57-4>4</a>
</span><span class=lnt id=hl-57-5><a class=lnlinks href=#hl-57-5>5</a>
</span><span class=lnt id=hl-57-6><a class=lnlinks href=#hl-57-6>6</a>
</span><span class=lnt id=hl-57-7><a class=lnlinks href=#hl-57-7>7</a>
</span><span class=lnt id=hl-57-8><a class=lnlinks href=#hl-57-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Persons</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Id_P</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>CHECK</span><span class=w> </span><span class=p>(</span><span class=n>Id_P</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>LastName</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>FirstName</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Address</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>City</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><p>IN</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-58-1><a class=lnlinks href=#hl-58-1>1</a>
</span><span class=lnt id=hl-58-2><a class=lnlinks href=#hl-58-2>2</a>
</span><span class=lnt id=hl-58-3><a class=lnlinks href=#hl-58-3>3</a>
</span><span class=lnt id=hl-58-4><a class=lnlinks href=#hl-58-4>4</a>
</span><span class=lnt id=hl-58-5><a class=lnlinks href=#hl-58-5>5</a>
</span><span class=lnt id=hl-58-6><a class=lnlinks href=#hl-58-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>Create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>test</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Ccity</span><span class=w> </span><span class=nb>char</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=n>checcity</span><span class=w> </span><span class=k>check</span><span class=p>(</span><span class=w> </span><span class=n>ccity</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=err>‘</span><span class=n>beijing</span><span class=err>’</span><span class=p>,</span><span class=err>’</span><span class=n>changchun</span><span class=err>’</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>test</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>add</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=n>checcity</span><span class=w> </span><span class=k>check</span><span class=p>(</span><span class=n>ccity</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=err>‘</span><span class=n>beijing</span><span class=err>’</span><span class=p>,</span><span class=err>’</span><span class=n>changchun</span><span class=err>’</span><span class=p>))</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>LIKE</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-59-1><a class=lnlinks href=#hl-59-1>1</a>
</span><span class=lnt id=hl-59-2><a class=lnlinks href=#hl-59-2>2</a>
</span><span class=lnt id=hl-59-3><a class=lnlinks href=#hl-59-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>Create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>test</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Cardid</span><span class=w> </span><span class=nb>char</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=n>checard</span><span class=w> </span><span class=k>check</span><span class=p>(</span><span class=n>cardid</span><span class=w> </span><span class=k>like</span><span class=p>(</span><span class=err>‘</span><span class=p>[</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=p>][</span><span class=n>a</span><span class=o>-</span><span class=n>z</span><span class=p>][</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=p>][</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>’</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>BETWEEN AND</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-60-1><a class=lnlinks href=#hl-60-1>1</a>
</span><span class=lnt id=hl-60-2><a class=lnlinks href=#hl-60-2>2</a>
</span><span class=lnt id=hl-60-3><a class=lnlinks href=#hl-60-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>Create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>test</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cardid</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=n>checard</span><span class=w> </span><span class=k>check</span><span class=p>(</span><span class=n>cardid</span><span class=w> </span><span class=k>between</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=mi>200</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><p>如果需要命名 CHECK 约束，以及为多个列定义 CHECK 约束，请使用下面的 SQL 语法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-61-1><a class=lnlinks href=#hl-61-1>1</a>
</span><span class=lnt id=hl-61-2><a class=lnlinks href=#hl-61-2>2</a>
</span><span class=lnt id=hl-61-3><a class=lnlinks href=#hl-61-3>3</a>
</span><span class=lnt id=hl-61-4><a class=lnlinks href=#hl-61-4>4</a>
</span><span class=lnt id=hl-61-5><a class=lnlinks href=#hl-61-5>5</a>
</span><span class=lnt id=hl-61-6><a class=lnlinks href=#hl-61-6>6</a>
</span><span class=lnt id=hl-61-7><a class=lnlinks href=#hl-61-7>7</a>
</span><span class=lnt id=hl-61-8><a class=lnlinks href=#hl-61-8>8</a>
</span><span class=lnt id=hl-61-9><a class=lnlinks href=#hl-61-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Persons</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Id_P</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>LastName</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>FirstName</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Address</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>City</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>chk_Person</span><span class=w> </span><span class=k>CHECK</span><span class=w> </span><span class=p>(</span><span class=n>Id_P</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>City</span><span class=o>=</span><span class=s1>&#39;Sandnes&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果在表已存在的情况下为 &ldquo;Id_P&rdquo; 列创建 CHECK 约束，请使用下面的 SQL：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-62-1><a class=lnlinks href=#hl-62-1>1</a>
</span><span class=lnt id=hl-62-2><a class=lnlinks href=#hl-62-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Persons</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ADD</span><span class=w> </span><span class=k>CHECK</span><span class=w> </span><span class=p>(</span><span class=n>Id_P</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果需要命名 CHECK 约束，以及为多个列定义 CHECK 约束，请使用下面的 SQL 语法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-63-1><a class=lnlinks href=#hl-63-1>1</a>
</span><span class=lnt id=hl-63-2><a class=lnlinks href=#hl-63-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Persons</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ADD</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>chk_Person</span><span class=w> </span><span class=k>CHECK</span><span class=w> </span><span class=p>(</span><span class=n>Id_P</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>City</span><span class=o>=</span><span class=s1>&#39;Sandnes&#39;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如需撤销 CHECK 约束，请使用下面的 SQL：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-64-1><a class=lnlinks href=#hl-64-1>1</a>
</span><span class=lnt id=hl-64-2><a class=lnlinks href=#hl-64-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Persons</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DROP</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>chk_Person</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Default</p><ul><li><p>DEFAULT 约束用于向列中插入默认值。</p><p>如果没有规定其他的值，那么会将默认值添加到所有的新记录。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-65-1><a class=lnlinks href=#hl-65-1>1</a>
</span><span class=lnt id=hl-65-2><a class=lnlinks href=#hl-65-2>2</a>
</span><span class=lnt id=hl-65-3><a class=lnlinks href=#hl-65-3>3</a>
</span><span class=lnt id=hl-65-4><a class=lnlinks href=#hl-65-4>4</a>
</span><span class=lnt id=hl-65-5><a class=lnlinks href=#hl-65-5>5</a>
</span><span class=lnt id=hl-65-6><a class=lnlinks href=#hl-65-6>6</a>
</span><span class=lnt id=hl-65-7><a class=lnlinks href=#hl-65-7>7</a>
</span><span class=lnt id=hl-65-8><a class=lnlinks href=#hl-65-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Persons</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Id_P</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>LastName</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>FirstName</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Address</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>City</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;Sandnes&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>通过使用类似 GETDATE() 这样的函数，DEFAULT 约束也可以用于插入系统值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-66-1><a class=lnlinks href=#hl-66-1>1</a>
</span><span class=lnt id=hl-66-2><a class=lnlinks href=#hl-66-2>2</a>
</span><span class=lnt id=hl-66-3><a class=lnlinks href=#hl-66-3>3</a>
</span><span class=lnt id=hl-66-4><a class=lnlinks href=#hl-66-4>4</a>
</span><span class=lnt id=hl-66-5><a class=lnlinks href=#hl-66-5>5</a>
</span><span class=lnt id=hl-66-6><a class=lnlinks href=#hl-66-6>6</a>
</span><span class=lnt id=hl-66-7><a class=lnlinks href=#hl-66-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Id_O</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>OrderNo</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Id_P</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>OrderDate</span><span class=w> </span><span class=nb>date</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>GETDATE</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果在表已存在的情况下为 &ldquo;City&rdquo; 列创建 DEFAULT 约束，请使用下面的 SQL：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-67-1><a class=lnlinks href=#hl-67-1>1</a>
</span><span class=lnt id=hl-67-2><a class=lnlinks href=#hl-67-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Persons</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=n>City</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;SANDNES&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如需撤销 DEFAULT 约束，请使用下面的 SQL：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-68-1><a class=lnlinks href=#hl-68-1>1</a>
</span><span class=lnt id=hl-68-2><a class=lnlinks href=#hl-68-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Persons</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=n>City</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li></ul></li><li><p>更新表</p><p>例1：向Student表增加“入学时间”列，其数据类型为日期型。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-69-1><a class=lnlinks href=#hl-69-1>1</a>
</span><span class=lnt id=hl-69-2><a class=lnlinks href=#hl-69-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Student</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ADD</span><span class=w> </span><span class=n>Scome</span><span class=w> </span><span class=nb>DATE</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>例2：删除属性列。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-70-1><a class=lnlinks href=#hl-70-1>1</a>
</span><span class=lnt id=hl-70-2><a class=lnlinks href=#hl-70-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>Alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>table_name</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>column_name</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>例3：将年龄的数据类型改为整数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-71-1><a class=lnlinks href=#hl-71-1>1</a>
</span><span class=lnt id=hl-71-2><a class=lnlinks href=#hl-71-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Student</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>MODIFY</span><span class=w> </span><span class=n>Sage</span><span class=w> </span><span class=nb>INT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>例4：删除学生姓名必须取唯一值的约束。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-72-1><a class=lnlinks href=#hl-72-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>Student</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=n>unisname</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>删除表</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-73-1><a class=lnlinks href=#hl-73-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>table_name</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>DROP TABLE 不能用于除去由 FOREIGN KEY 约束引用的表。必须先除去引用的 FOREIGN KEY 约束或引用的表。</p><p>表所有者可以除去任何数据库内的表。除去表时，表上的规则或默认值将解除绑定，任何与表关联的约束或触发器将自动除去。如果重新创建表，必须重新绑定适当的规则和默认值，重新创建任何触发器并添加必要的约束。</p></li><li><p>重命名表</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-74-1><a class=lnlinks href=#hl-74-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>RENAEM</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>test1</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>test2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=第二十二章使用视图>第二十二章：使用视图<a hidden class=anchor aria-hidden=true href=#第二十二章使用视图>#</a></h2><ol><li><p>视图</p><p>视图是一个虚拟的表，是一个表中的数据经过某种筛选后的显示方式，视图由一个预定义的查询select语句组成。</p><p>视图的特点：</p><ul><li>视图中的数据并不属于视图本身，而是属于基本的表，对视图可以像表一样进行insert,update,delete操作。</li><li>视图不能被修改，表修改或者删除后应该删除视图再重建。</li><li>视图的数量没有限制，但是命名不能和视图以及表重复，具有唯一性。</li><li>视图可以被嵌套，一个视图中可以嵌套另一个视图。</li><li>视图不能索引，不能有相关联的触发器和默认值。</li><li>视图可以和表一起使用。</li></ul></li><li><p>使用视图</p><ul><li><p>创建视图</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-75-1><a class=lnlinks href=#hl-75-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w>  </span><span class=k>VIEW</span><span class=w> </span><span class=o>&lt;</span><span class=err>视图名</span><span class=o>&gt;</span><span class=w>  </span><span class=p>[(</span><span class=o>&lt;</span><span class=err>列名</span><span class=o>&gt;</span><span class=w>  </span><span class=p>[</span><span class=err>，</span><span class=o>&lt;</span><span class=err>列名</span><span class=o>&gt;</span><span class=p>]</span><span class=err>…</span><span class=p>)]</span><span class=w> </span><span class=k>AS</span><span class=w>  </span><span class=o>&lt;</span><span class=err>子查询</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><p>例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-76-1><a class=lnlinks href=#hl-76-1>1</a>
</span><span class=lnt id=hl-76-2><a class=lnlinks href=#hl-76-2>2</a>
</span><span class=lnt id=hl-76-3><a class=lnlinks href=#hl-76-3>3</a>
</span><span class=lnt id=hl-76-4><a class=lnlinks href=#hl-76-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=n>IS_Student</span><span class=w> </span><span class=k>AS</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>Sno</span><span class=err>，</span><span class=n>Sname</span><span class=err>，</span><span class=n>Sage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>Sdept</span><span class=o>=</span><span class=w> </span><span class=s1>&#39;IS&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><p>基于视图的视图</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-77-1><a class=lnlinks href=#hl-77-1>1</a>
</span><span class=lnt id=hl-77-2><a class=lnlinks href=#hl-77-2>2</a>
</span><span class=lnt id=hl-77-3><a class=lnlinks href=#hl-77-3>3</a>
</span><span class=lnt id=hl-77-4><a class=lnlinks href=#hl-77-4>4</a>
</span><span class=lnt id=hl-77-5><a class=lnlinks href=#hl-77-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=n>IS_S2</span><span class=w> </span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>Sno</span><span class=err>，</span><span class=n>Sname</span><span class=err>，</span><span class=n>Grade</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--这是一个视图
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>FROM</span><span class=w> </span><span class=n>IS_S1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>Grade</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>90</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-78-1><a class=lnlinks href=#hl-78-1>1</a>
</span><span class=lnt id=hl-78-2><a class=lnlinks href=#hl-78-2>2</a>
</span><span class=lnt id=hl-78-3><a class=lnlinks href=#hl-78-3>3</a>
</span><span class=lnt id=hl-78-4><a class=lnlinks href=#hl-78-4>4</a>
</span><span class=lnt id=hl-78-5><a class=lnlinks href=#hl-78-5>5</a>
</span><span class=lnt id=hl-78-6><a class=lnlinks href=#hl-78-6>6</a>
</span><span class=lnt id=hl-78-7><a class=lnlinks href=#hl-78-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>- 查询视图
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```sql
</span></span><span class=line><span class=cl>SELECT Sno，Sage
</span></span><span class=line><span class=cl>FROM IS_Student
</span></span><span class=line><span class=cl>WHERE Sage &lt; 20;
</span></span></code></pre></td></tr></table></div></div><ul><li><p>更新视图</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-79-1><a class=lnlinks href=#hl-79-1>1</a>
</span><span class=lnt id=hl-79-2><a class=lnlinks href=#hl-79-2>2</a>
</span><span class=lnt id=hl-79-3><a class=lnlinks href=#hl-79-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UPDATE</span><span class=w> </span><span class=n>IS_Student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>Sname</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;刘辰&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>Sno</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;95002&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>删除视图</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-80-1><a class=lnlinks href=#hl-80-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=o>&lt;</span><span class=err>视图名</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li></ol><h2 id=第二十三章使用存储过程>第二十三章：使用存储过程<a hidden class=anchor aria-hidden=true href=#第二十三章使用存储过程>#</a></h2><ol><li><p>存储过程</p><p>将常用的或很复杂的工作，预先用SQL语句写好并用一个指定的名称存储起来, 那么以后要叫数据库提供与已定义好的存储过程的功能相同的服务时,只需调用execute,即可自动完成命令。</p><p>优点：</p><ul><li>存储过程只在创造时进行编译，以后每次执行存储过程都不需再重新编译，而一般SQL语句每执行一次就编译一次,所以使用存储过程可提高数据库执行速度。</li><li>当对数据库进行复杂操作时(如对多个表进行Update,Insert,Query,Delete时)，可将此复杂操作用存储过程封装起来与数据库提供的事务处理结合一起使用。</li><li>存储过程可以重复使用,可减少数据库开发人员的工作量。</li><li>安全性高,可设定只有某此用户才具有对指定存储过程的使用权。</li></ul></li><li><p>使用存储过程</p><p>注意每一句sql都要以；结尾。</p><ul><li><p>简单的创建存储过程</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-81-1><a class=lnlinks href=#hl-81-1>1</a>
</span><span class=lnt id=hl-81-2><a class=lnlinks href=#hl-81-2>2</a>
</span><span class=lnt id=hl-81-3><a class=lnlinks href=#hl-81-3>3</a>
</span><span class=lnt id=hl-81-4><a class=lnlinks href=#hl-81-4>4</a>
</span><span class=lnt id=hl-81-5><a class=lnlinks href=#hl-81-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>prcPrintRecruitmentAgencyList</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>SELECT</span><span class=w> </span><span class=n>cName</span><span class=p>,</span><span class=w> </span><span class=n>vAddress</span><span class=p>,</span><span class=w> </span><span class=n>cCity</span><span class=p>,</span><span class=w> </span><span class=n>cZip</span><span class=p>,</span><span class=w> </span><span class=n>cPhone</span><span class=p>,</span><span class=w> </span><span class=n>cFax</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FROM</span><span class=w> </span><span class=n>RecruitmentAgencies</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>运行存储过程</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-82-1><a class=lnlinks href=#hl-82-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CALL</span><span class=w> </span><span class=n>processing_name</span><span class=p>(</span><span class=o>@</span><span class=k>variable</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>创建带输入参数的存储过程</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-83-1><a class=lnlinks href=#hl-83-1> 1</a>
</span><span class=lnt id=hl-83-2><a class=lnlinks href=#hl-83-2> 2</a>
</span><span class=lnt id=hl-83-3><a class=lnlinks href=#hl-83-3> 3</a>
</span><span class=lnt id=hl-83-4><a class=lnlinks href=#hl-83-4> 4</a>
</span><span class=lnt id=hl-83-5><a class=lnlinks href=#hl-83-5> 5</a>
</span><span class=lnt id=hl-83-6><a class=lnlinks href=#hl-83-6> 6</a>
</span><span class=lnt id=hl-83-7><a class=lnlinks href=#hl-83-7> 7</a>
</span><span class=lnt id=hl-83-8><a class=lnlinks href=#hl-83-8> 8</a>
</span><span class=lnt id=hl-83-9><a class=lnlinks href=#hl-83-9> 9</a>
</span><span class=lnt id=hl-83-10><a class=lnlinks href=#hl-83-10>10</a>
</span><span class=lnt id=hl-83-11><a class=lnlinks href=#hl-83-11>11</a>
</span><span class=lnt id=hl-83-12><a class=lnlinks href=#hl-83-12>12</a>
</span><span class=lnt id=hl-83-13><a class=lnlinks href=#hl-83-13>13</a>
</span><span class=lnt id=hl-83-14><a class=lnlinks href=#hl-83-14>14</a>
</span><span class=lnt id=hl-83-15><a class=lnlinks href=#hl-83-15>15</a>
</span><span class=lnt id=hl-83-16><a class=lnlinks href=#hl-83-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>productpricing</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>OUT</span><span class=w> </span><span class=n>pl</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>OUT</span><span class=w> </span><span class=n>ph</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>OUT</span><span class=w> </span><span class=n>pa</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>Min</span><span class=p>(</span><span class=n>prod_price</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INTO</span><span class=w> </span><span class=n>pl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>Max</span><span class=p>(</span><span class=n>prod_price</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INTO</span><span class=w> </span><span class=n>ph</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>prod_price</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INTO</span><span class=w> </span><span class=n>pa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>关键字OUT指出相应的参数用来从存储过程传出一个值返回给调用者。MySQL支持IN（传递给存储过程）、OUT、INOUT（对存储过程传入传出）。</p><p>通过INTO将值传入参数。</p><blockquote><p><code>DECIMAL</code>数据类型用于在数据库中存储精确的数值。我们经常将<code>DECIMAL</code>数据类型用于保留准确精确度的列，例如会计系统中的货币数据。</p><p>要定义数据类型为<code>DECIMAL</code>的列，请使用以下语法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-84-1><a class=lnlinks href=#hl-84-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>column_name</span><span class=w> </span><span class=o>``</span><span class=nb>DECIMAL</span><span class=o>``</span><span class=p>(</span><span class=n>P</span><span class=p>,</span><span class=n>D</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>在上面的语法中：</p><ul><li><code>P</code>是表示有效数字数的精度。 <code>P</code>范围为<code>1〜65</code>。</li><li><code>D</code>是表示小数点后的位数。 <code>D</code>的范围是<code>0</code>~<code>30</code>。MySQL要求<code>D</code>小于或等于(<code>&lt;=</code>)<code>P</code>。</li></ul><p><code>DECIMAL(P，D)</code>表示列可以存储<code>D</code>位小数的<code>P</code>位数。十进制列的实际范围取决于精度和刻度。</p></blockquote><p>运行上面的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-85-1><a class=lnlinks href=#hl-85-1>1</a>
</span><span class=lnt id=hl-85-2><a class=lnlinks href=#hl-85-2>2</a>
</span><span class=lnt id=hl-85-3><a class=lnlinks href=#hl-85-3>3</a>
</span><span class=lnt id=hl-85-4><a class=lnlinks href=#hl-85-4>4</a>
</span><span class=lnt id=hl-85-5><a class=lnlinks href=#hl-85-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CALL</span><span class=w> </span><span class=n>productpricing</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>@</span><span class=n>pricelow</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>@</span><span class=n>pricehigh</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>@</span><span class=n>priceaverage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果想检索变量的值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-86-1><a class=lnlinks href=#hl-86-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>@</span><span class=n>pricelow</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>pricehigh</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>priceaverage</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>另一个例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-87-1><a class=lnlinks href=#hl-87-1> 1</a>
</span><span class=lnt id=hl-87-2><a class=lnlinks href=#hl-87-2> 2</a>
</span><span class=lnt id=hl-87-3><a class=lnlinks href=#hl-87-3> 3</a>
</span><span class=lnt id=hl-87-4><a class=lnlinks href=#hl-87-4> 4</a>
</span><span class=lnt id=hl-87-5><a class=lnlinks href=#hl-87-5> 5</a>
</span><span class=lnt id=hl-87-6><a class=lnlinks href=#hl-87-6> 6</a>
</span><span class=lnt id=hl-87-7><a class=lnlinks href=#hl-87-7> 7</a>
</span><span class=lnt id=hl-87-8><a class=lnlinks href=#hl-87-8> 8</a>
</span><span class=lnt id=hl-87-9><a class=lnlinks href=#hl-87-9> 9</a>
</span><span class=lnt id=hl-87-10><a class=lnlinks href=#hl-87-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>ordertotal</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IN</span><span class=w> </span><span class=n>onumber</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>OUT</span><span class=w> </span><span class=n>ototal</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>Sum</span><span class=p>(</span><span class=n>item_price</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>quanlity</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orderitems</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>order_num</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>onumber</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INTO</span><span class=w> </span><span class=n>ototal</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-88-1><a class=lnlinks href=#hl-88-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CALL</span><span class=w> </span><span class=n>ordertotal</span><span class=p>(</span><span class=mi>20005</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>total</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-89-1><a class=lnlinks href=#hl-89-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>@</span><span class=n>total</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>删除存储过程</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-90-1><a class=lnlinks href=#hl-90-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>processing_name</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>建立智能存储过程</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-91-1><a class=lnlinks href=#hl-91-1> 1</a>
</span><span class=lnt id=hl-91-2><a class=lnlinks href=#hl-91-2> 2</a>
</span><span class=lnt id=hl-91-3><a class=lnlinks href=#hl-91-3> 3</a>
</span><span class=lnt id=hl-91-4><a class=lnlinks href=#hl-91-4> 4</a>
</span><span class=lnt id=hl-91-5><a class=lnlinks href=#hl-91-5> 5</a>
</span><span class=lnt id=hl-91-6><a class=lnlinks href=#hl-91-6> 6</a>
</span><span class=lnt id=hl-91-7><a class=lnlinks href=#hl-91-7> 7</a>
</span><span class=lnt id=hl-91-8><a class=lnlinks href=#hl-91-8> 8</a>
</span><span class=lnt id=hl-91-9><a class=lnlinks href=#hl-91-9> 9</a>
</span><span class=lnt id=hl-91-10><a class=lnlinks href=#hl-91-10>10</a>
</span><span class=lnt id=hl-91-11><a class=lnlinks href=#hl-91-11>11</a>
</span><span class=lnt id=hl-91-12><a class=lnlinks href=#hl-91-12>12</a>
</span><span class=lnt id=hl-91-13><a class=lnlinks href=#hl-91-13>13</a>
</span><span class=lnt id=hl-91-14><a class=lnlinks href=#hl-91-14>14</a>
</span><span class=lnt id=hl-91-15><a class=lnlinks href=#hl-91-15>15</a>
</span><span class=lnt id=hl-91-16><a class=lnlinks href=#hl-91-16>16</a>
</span><span class=lnt id=hl-91-17><a class=lnlinks href=#hl-91-17>17</a>
</span><span class=lnt id=hl-91-18><a class=lnlinks href=#hl-91-18>18</a>
</span><span class=lnt id=hl-91-19><a class=lnlinks href=#hl-91-19>19</a>
</span><span class=lnt id=hl-91-20><a class=lnlinks href=#hl-91-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DELIMITER</span><span class=w> </span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>ordertotal</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IN</span><span class=w> </span><span class=n>onumber</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IN</span><span class=w> </span><span class=n>taxable</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>OUT</span><span class=w> </span><span class=n>ototal</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DECLARE</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DECLARE</span><span class=w> </span><span class=n>taxrate</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>6</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>Sum</span><span class=p>(</span><span class=n>item_price</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>quanlity</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orderitems</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>order_num</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>onumber</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INTO</span><span class=w> </span><span class=n>ototal</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--Is this taxable?
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>IF</span><span class=w> </span><span class=n>taxable</span><span class=w> </span><span class=k>THEN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>tatal</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>taxrate</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=k>IF</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>ototal</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>DELIMITER $$ 声明分隔符为$，而在语句中；还是语句的结尾，而且是存储过程的一部分。要是不加的话，应用会认为；不是存储过程的一部分，会报错。</p></blockquote></li><li><p>检查存储过程</p><p>获得包括何时、有谁创建等详细信息的存储过程列表</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-92-1><a class=lnlinks href=#hl-92-1>1</a>
</span><span class=lnt id=hl-92-2><a class=lnlinks href=#hl-92-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>STATUS</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SHOW</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>STATUS</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;SAD&#39;</span><span class=p>;</span><span class=c1>--获得特定的值
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li></ol><h2 id=第二十四章语句的分割流程控制变量>第二十四章：语句的分割，流程控制，变量<a hidden class=anchor aria-hidden=true href=#第二十四章语句的分割流程控制变量>#</a></h2><ol><li><p>语句分块</p><p>BEGIN, END用来限定存储过程体，相当于java里的&rsquo;{ }'</p></li><li><p>流程控制</p><ul><li><p>if，else</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-93-1><a class=lnlinks href=#hl-93-1> 1</a>
</span><span class=lnt id=hl-93-2><a class=lnlinks href=#hl-93-2> 2</a>
</span><span class=lnt id=hl-93-3><a class=lnlinks href=#hl-93-3> 3</a>
</span><span class=lnt id=hl-93-4><a class=lnlinks href=#hl-93-4> 4</a>
</span><span class=lnt id=hl-93-5><a class=lnlinks href=#hl-93-5> 5</a>
</span><span class=lnt id=hl-93-6><a class=lnlinks href=#hl-93-6> 6</a>
</span><span class=lnt id=hl-93-7><a class=lnlinks href=#hl-93-7> 7</a>
</span><span class=lnt id=hl-93-8><a class=lnlinks href=#hl-93-8> 8</a>
</span><span class=lnt id=hl-93-9><a class=lnlinks href=#hl-93-9> 9</a>
</span><span class=lnt id=hl-93-10><a class=lnlinks href=#hl-93-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>PRC</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DECLARE</span><span class=w> </span><span class=nb>NUMBER</span><span class=w> </span><span class=nb>INT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=nb>NUMBER</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>IF</span><span class=w> </span><span class=nb>NUMBER</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=k>THEN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=nb>NUMBER</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ELSE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=nb>NUMBER</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=k>IF</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>while</p><p>使用方法与其他语言类似。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-94-1><a class=lnlinks href=#hl-94-1>1</a>
</span><span class=lnt id=hl-94-2><a class=lnlinks href=#hl-94-2>2</a>
</span><span class=lnt id=hl-94-3><a class=lnlinks href=#hl-94-3>3</a>
</span><span class=lnt id=hl-94-4><a class=lnlinks href=#hl-94-4>4</a>
</span><span class=lnt id=hl-94-5><a class=lnlinks href=#hl-94-5>5</a>
</span><span class=lnt id=hl-94-6><a class=lnlinks href=#hl-94-6>6</a>
</span><span class=lnt id=hl-94-7><a class=lnlinks href=#hl-94-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DECLARE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=nb>int</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>WHILE</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=p>(</span><span class=n>userid</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=p>(</span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=n>WHILE</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>go</p><p>go是用来分开多条sql语句的，一个执行成功后才会执行下一个。</p></li><li><p>return</p><p>返回值，或结束程序。</p></li></ul></li><li><p>变量的定义与赋值</p><ul><li><p>定义</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-95-1><a class=lnlinks href=#hl-95-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DECLARE</span><span class=w> </span><span class=n>local_variable</span><span class=w> </span><span class=n>data_type</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>赋值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-96-1><a class=lnlinks href=#hl-96-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=n>local_variable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>variavle_value</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-97-1><a class=lnlinks href=#hl-97-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>variavle_value</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>local_variable</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li></ol><h2 id=第二十五章使用游标>第二十五章：使用游标<a hidden class=anchor aria-hidden=true href=#第二十五章使用游标>#</a></h2><ol><li><p>游标</p><p>有时需要在检索出来的行中前进或后退一行或多行，这就是使用游标的原因。而游标，就是一个存储在服务器上的数据库查询，它不是一条SELECT语句，而是被检索出来的结果集。</p><p>在MySQL中，游标只能用于存储过程和存储函数。</p></li><li><p>使用游标</p><p>几个步骤：</p><ul><li><p>先定义游标。</p></li><li><p>打开游标以供使用。</p></li><li><p>对于有数据的游标，根据需要取出数据。</p></li><li><p>结束游标时，关闭游标。</p></li><li><p>创建游标</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-98-1><a class=lnlinks href=#hl-98-1>1</a>
</span><span class=lnt id=hl-98-2><a class=lnlinks href=#hl-98-2>2</a>
</span><span class=lnt id=hl-98-3><a class=lnlinks href=#hl-98-3>3</a>
</span><span class=lnt id=hl-98-4><a class=lnlinks href=#hl-98-4>4</a>
</span><span class=lnt id=hl-98-5><a class=lnlinks href=#hl-98-5>5</a>
</span><span class=lnt id=hl-98-6><a class=lnlinks href=#hl-98-6>6</a>
</span><span class=lnt id=hl-98-7><a class=lnlinks href=#hl-98-7>7</a>
</span><span class=lnt id=hl-98-8><a class=lnlinks href=#hl-98-8>8</a>
</span><span class=lnt id=hl-98-9><a class=lnlinks href=#hl-98-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>processorders</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>ordernumbers</span><span class=w> </span><span class=k>CURSOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>--对下面的查询建立游标
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=n>order_num</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordeRs</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>declare</span><span class=w> </span><span class=n>asd</span><span class=w> </span><span class=k>cursor</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>用DECLARE来声明游标。</p></li><li><p>打开和关闭游标</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-99-1><a class=lnlinks href=#hl-99-1>1</a>
</span><span class=lnt id=hl-99-2><a class=lnlinks href=#hl-99-2>2</a>
</span><span class=lnt id=hl-99-3><a class=lnlinks href=#hl-99-3>3</a>
</span><span class=lnt id=hl-99-4><a class=lnlinks href=#hl-99-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--打开游标
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>OPEN</span><span class=w> </span><span class=k>CURSOR</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--关闭游标
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CLOSE</span><span class=w> </span><span class=k>CURSOR</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>和上一条的例子结合：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-100-1><a class=lnlinks href=#hl-100-1>1</a>
</span><span class=lnt id=hl-100-2><a class=lnlinks href=#hl-100-2>2</a>
</span><span class=lnt id=hl-100-3><a class=lnlinks href=#hl-100-3>3</a>
</span><span class=lnt id=hl-100-4><a class=lnlinks href=#hl-100-4>4</a>
</span><span class=lnt id=hl-100-5><a class=lnlinks href=#hl-100-5>5</a>
</span><span class=lnt id=hl-100-6><a class=lnlinks href=#hl-100-6>6</a>
</span><span class=lnt id=hl-100-7><a class=lnlinks href=#hl-100-7>7</a>
</span><span class=lnt id=hl-100-8><a class=lnlinks href=#hl-100-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>processorders</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>ordernumbers</span><span class=w> </span><span class=k>CURSOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=n>order_num</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordeRs</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>OPEN</span><span class=w> </span><span class=n>ordernumbers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>CLOSE</span><span class=w> </span><span class=n>ordernumbers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>使用游标数据</p><ul><li><p>检索单个行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-101-1><a class=lnlinks href=#hl-101-1> 1</a>
</span><span class=lnt id=hl-101-2><a class=lnlinks href=#hl-101-2> 2</a>
</span><span class=lnt id=hl-101-3><a class=lnlinks href=#hl-101-3> 3</a>
</span><span class=lnt id=hl-101-4><a class=lnlinks href=#hl-101-4> 4</a>
</span><span class=lnt id=hl-101-5><a class=lnlinks href=#hl-101-5> 5</a>
</span><span class=lnt id=hl-101-6><a class=lnlinks href=#hl-101-6> 6</a>
</span><span class=lnt id=hl-101-7><a class=lnlinks href=#hl-101-7> 7</a>
</span><span class=lnt id=hl-101-8><a class=lnlinks href=#hl-101-8> 8</a>
</span><span class=lnt id=hl-101-9><a class=lnlinks href=#hl-101-9> 9</a>
</span><span class=lnt id=hl-101-10><a class=lnlinks href=#hl-101-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>processorders</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=nb>INT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>ordernumbers</span><span class=w> </span><span class=k>CURSOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=n>order_num</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordeRs</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>OPEN</span><span class=w> </span><span class=n>ordernumbers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FETCH</span><span class=w> </span><span class=n>ordernumbers</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>o</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>CLOSE</span><span class=w> </span><span class=n>ordernumbers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>用fetch将第一行数据放入变量o中。</p></li><li><p>循环检索行（全部行）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-102-1><a class=lnlinks href=#hl-102-1> 1</a>
</span><span class=lnt id=hl-102-2><a class=lnlinks href=#hl-102-2> 2</a>
</span><span class=lnt id=hl-102-3><a class=lnlinks href=#hl-102-3> 3</a>
</span><span class=lnt id=hl-102-4><a class=lnlinks href=#hl-102-4> 4</a>
</span><span class=lnt id=hl-102-5><a class=lnlinks href=#hl-102-5> 5</a>
</span><span class=lnt id=hl-102-6><a class=lnlinks href=#hl-102-6> 6</a>
</span><span class=lnt id=hl-102-7><a class=lnlinks href=#hl-102-7> 7</a>
</span><span class=lnt id=hl-102-8><a class=lnlinks href=#hl-102-8> 8</a>
</span><span class=lnt id=hl-102-9><a class=lnlinks href=#hl-102-9> 9</a>
</span><span class=lnt id=hl-102-10><a class=lnlinks href=#hl-102-10>10</a>
</span><span class=lnt id=hl-102-11><a class=lnlinks href=#hl-102-11>11</a>
</span><span class=lnt id=hl-102-12><a class=lnlinks href=#hl-102-12>12</a>
</span><span class=lnt id=hl-102-13><a class=lnlinks href=#hl-102-13>13</a>
</span><span class=lnt id=hl-102-14><a class=lnlinks href=#hl-102-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>processorders</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=nb>INT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>done</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>ordernumbers</span><span class=w> </span><span class=k>CURSOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=n>order_num</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordeRs</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=k>CONTINUE</span><span class=w> </span><span class=k>HANDLER</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>SQLSTATE</span><span class=w> </span><span class=s1>&#39;02000&#39;</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>done</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>OPEN</span><span class=w> </span><span class=n>ordernumbers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>REPEAT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FETCH</span><span class=w> </span><span class=n>ordernumbers</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>o</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>UNTIL</span><span class=w> </span><span class=n>done</span><span class=w> </span><span class=k>END</span><span class=w> </span><span class=n>REPEAT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>CLOSE</span><span class=w> </span><span class=n>ordernumbers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>先是用DECLARE声明了一个CONTINUE HANDLER，条件是SQLSTATE 为'02000&rsquo;时，SET done = 1。</p><p>然后在REPEAT区块内，重复执行fetch，直到done = 1才会结束重复。</p><p>这样就是循环检索所有行来获得目标记录。</p></li><li><p>综合例子</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-103-1><a class=lnlinks href=#hl-103-1> 1</a>
</span><span class=lnt id=hl-103-2><a class=lnlinks href=#hl-103-2> 2</a>
</span><span class=lnt id=hl-103-3><a class=lnlinks href=#hl-103-3> 3</a>
</span><span class=lnt id=hl-103-4><a class=lnlinks href=#hl-103-4> 4</a>
</span><span class=lnt id=hl-103-5><a class=lnlinks href=#hl-103-5> 5</a>
</span><span class=lnt id=hl-103-6><a class=lnlinks href=#hl-103-6> 6</a>
</span><span class=lnt id=hl-103-7><a class=lnlinks href=#hl-103-7> 7</a>
</span><span class=lnt id=hl-103-8><a class=lnlinks href=#hl-103-8> 8</a>
</span><span class=lnt id=hl-103-9><a class=lnlinks href=#hl-103-9> 9</a>
</span><span class=lnt id=hl-103-10><a class=lnlinks href=#hl-103-10>10</a>
</span><span class=lnt id=hl-103-11><a class=lnlinks href=#hl-103-11>11</a>
</span><span class=lnt id=hl-103-12><a class=lnlinks href=#hl-103-12>12</a>
</span><span class=lnt id=hl-103-13><a class=lnlinks href=#hl-103-13>13</a>
</span><span class=lnt id=hl-103-14><a class=lnlinks href=#hl-103-14>14</a>
</span><span class=lnt id=hl-103-15><a class=lnlinks href=#hl-103-15>15</a>
</span><span class=lnt id=hl-103-16><a class=lnlinks href=#hl-103-16>16</a>
</span><span class=lnt id=hl-103-17><a class=lnlinks href=#hl-103-17>17</a>
</span><span class=lnt id=hl-103-18><a class=lnlinks href=#hl-103-18>18</a>
</span><span class=lnt id=hl-103-19><a class=lnlinks href=#hl-103-19>19</a>
</span><span class=lnt id=hl-103-20><a class=lnlinks href=#hl-103-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>processorders</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=nb>INT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>done</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=n>ordernumbers</span><span class=w> </span><span class=k>CURSOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=n>order_num</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordeRs</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=k>CONTINUE</span><span class=w> </span><span class=k>HANDLER</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>SQLSTATE</span><span class=w> </span><span class=s1>&#39;02000&#39;</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>done</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>ordertotals</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>(</span><span class=n>order_num</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>OPEN</span><span class=w> </span><span class=n>ordernumbers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>REPEAT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FETCH</span><span class=w> </span><span class=n>ordernumbers</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>o</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>--调用存储过程进行计算和检查
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>		</span><span class=k>CALL</span><span class=w> </span><span class=n>ordertotal</span><span class=p>(</span><span class=n>o</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>ordertotals</span><span class=p>(</span><span class=n>order_num</span><span class=p>,</span><span class=w> </span><span class=n>total</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>o</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>UNTIL</span><span class=w> </span><span class=n>done</span><span class=w> </span><span class=k>END</span><span class=w> </span><span class=n>REPEAT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>CLOSE</span><span class=w> </span><span class=n>ordernumbers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li></ul></li></ol><h2 id=第二十六章使用触发器>第二十六章：使用触发器<a hidden class=anchor aria-hidden=true href=#第二十六章使用触发器>#</a></h2><ol><li><p>触发器</p><p>触发器是MySQL响应以下任意语句而自动执行的一条SQL语句：</p><ul><li>update</li><li>dalete</li><li>insert</li></ul></li><li><p>创建触发器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-104-1><a class=lnlinks href=#hl-104-1>1</a>
</span><span class=lnt id=hl-104-2><a class=lnlinks href=#hl-104-2>2</a>
</span><span class=lnt id=hl-104-3><a class=lnlinks href=#hl-104-3>3</a>
</span><span class=lnt id=hl-104-4><a class=lnlinks href=#hl-104-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--AFTER 代表这是一个后触发器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=n>newproduct</span><span class=w> </span><span class=k>AFTER</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FOR</span><span class=w> </span><span class=k>EACH</span><span class=w> </span><span class=k>ROW</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=s1>&#39;PROduct added&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--FOR EACH ROW 对每一行都起作用
</span></span></span></code></pre></td></tr></table></div></div><p>还有before 前触发器。</p></li><li><p>删除触发器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-105-1><a class=lnlinks href=#hl-105-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=n>newproduct</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>使用触发器</p><ul><li><p>INSERT触发器</p><p>在INSERT触发器代码内，可以引用一个名为NEW的虚拟表，访问被插入的行。</p><p>在前触发器中，NEW中的值可以被更新。</p><p>对于AUTO_INCREMENT列，NEW在INSERT执行前包含0，执行之后包含新的自动生成值。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-106-1><a class=lnlinks href=#hl-106-1>1</a>
</span><span class=lnt id=hl-106-2><a class=lnlinks href=#hl-106-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=n>neworder</span><span class=w> </span><span class=k>AFTER</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FOR</span><span class=w> </span><span class=k>EACH</span><span class=w> </span><span class=k>ROW</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>order_num</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-107-1><a class=lnlinks href=#hl-107-1> 1</a>
</span><span class=lnt id=hl-107-2><a class=lnlinks href=#hl-107-2> 2</a>
</span><span class=lnt id=hl-107-3><a class=lnlinks href=#hl-107-3> 3</a>
</span><span class=lnt id=hl-107-4><a class=lnlinks href=#hl-107-4> 4</a>
</span><span class=lnt id=hl-107-5><a class=lnlinks href=#hl-107-5> 5</a>
</span><span class=lnt id=hl-107-6><a class=lnlinks href=#hl-107-6> 6</a>
</span><span class=lnt id=hl-107-7><a class=lnlinks href=#hl-107-7> 7</a>
</span><span class=lnt id=hl-107-8><a class=lnlinks href=#hl-107-8> 8</a>
</span><span class=lnt id=hl-107-9><a class=lnlinks href=#hl-107-9> 9</a>
</span><span class=lnt id=hl-107-10><a class=lnlinks href=#hl-107-10>10</a>
</span><span class=lnt id=hl-107-11><a class=lnlinks href=#hl-107-11>11</a>
</span><span class=lnt id=hl-107-12><a class=lnlinks href=#hl-107-12>12</a>
</span><span class=lnt id=hl-107-13><a class=lnlinks href=#hl-107-13>13</a>
</span><span class=lnt id=hl-107-14><a class=lnlinks href=#hl-107-14>14</a>
</span><span class=lnt id=hl-107-15><a class=lnlinks href=#hl-107-15>15</a>
</span><span class=lnt id=hl-107-16><a class=lnlinks href=#hl-107-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>&gt; BEFORE触发器适用于数据验证和净化，AFTER触发器适用于操作后的输出、处理。
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>- DELETE触发器
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>在DELETE触发器代码内，可以引用一个名为OLD的虚拟表，访问被插入的行。
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>OLD表中的值为只读，不可更新。
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>   ```sql
</span></span><span class=line><span class=cl>   CREATE TRIGGER deleteorder BEFORE DELETE ON orders
</span></span><span class=line><span class=cl>   FOR EACH ROW
</span></span><span class=line><span class=cl>   BEGIN
</span></span><span class=line><span class=cl>   	INSERT INTO archive_orders(order_num, order_date)
</span></span><span class=line><span class=cl>   	VALUES(OLD.order_num, OLD.order_date);
</span></span><span class=line><span class=cl>   END;
</span></span></code></pre></td></tr></table></div></div><ul><li><p>UPDATE触发器</p><p>在UPDATE触发器代码内，可以引用一个名为OLD的虚拟表，访问更新前的值。可以引用一个名为NEW的虚拟表，访问更新后的值。</p><p>OLD表中的值为只读，不可更新。</p><p>在BEFORE触发器中，new中的值也可能会被更新。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-108-1><a class=lnlinks href=#hl-108-1>1</a>
</span><span class=lnt id=hl-108-2><a class=lnlinks href=#hl-108-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=n>updatevendor</span><span class=w> </span><span class=k>BEFORE</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>vendors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FOR</span><span class=w> </span><span class=k>EACH</span><span class=w> </span><span class=k>ROW</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>vend_state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>Upper</span><span class=p>(</span><span class=k>NEW</span><span class=p>.</span><span class=n>vend_state</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><ol start=5><li><p>一些事项</p><ul><li>MySQL中，在触发器内部，无法使用CALL来调用存储过程，只能将代码复制粘贴。</li><li>应该用触发器保证数据的一致性。</li></ul></li></ol><h2 id=第二十七章管理事务处理>第二十七章：管理事务处理<a hidden class=anchor aria-hidden=true href=#第二十七章管理事务处理>#</a></h2><ol><li><p>事务处理</p><p>用一个例子来了解：</p><ul><li>检查数据库是否存在相应的客户，如果不存在，添加它。</li><li>提交客户信息。</li><li>检索客户ID。</li><li>添加一行到表中。</li><li>如果在添加到表中的过程出现故障，回退。</li><li>在表中检索新ID。</li><li>对于订购的每一项物品，添加新行到另一个表中。</li><li>如果在添加到表中的过程出现故障，回退所有添加的行。</li><li>提交订单信息。</li></ul><p>事务（transaction）：一组SQL语句。</p><p>回退（rollback）：撤销SQL语句的过程。</p><p>提交（commit）：将未存储的SQL语句存储到数据库表。</p><p>保留点（savepoint）：事务处理中设置的临时占位符，可以对它发布回退。</p></li><li><p>控制事务处理</p><ul><li><p>ROLLBACK</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-109-1><a class=lnlinks href=#hl-109-1>1</a>
</span><span class=lnt id=hl-109-2><a class=lnlinks href=#hl-109-2>2</a>
</span><span class=lnt id=hl-109-3><a class=lnlinks href=#hl-109-3>3</a>
</span><span class=lnt id=hl-109-4><a class=lnlinks href=#hl-109-4>4</a>
</span><span class=lnt id=hl-109-5><a class=lnlinks href=#hl-109-5>5</a>
</span><span class=lnt id=hl-109-6><a class=lnlinks href=#hl-109-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordertotals</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordertotals</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordertotals</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordertotals</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>drop和create语句不能回退。</p></li><li><p>COMMIT</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-110-1><a class=lnlinks href=#hl-110-1>1</a>
</span><span class=lnt id=hl-110-2><a class=lnlinks href=#hl-110-2>2</a>
</span><span class=lnt id=hl-110-3><a class=lnlinks href=#hl-110-3>3</a>
</span><span class=lnt id=hl-110-4><a class=lnlinks href=#hl-110-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--只有delete执行成功才会对表进行更改
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>SAVEPOINT</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-111-1><a class=lnlinks href=#hl-111-1>1</a>
</span><span class=lnt id=hl-111-2><a class=lnlinks href=#hl-111-2>2</a>
</span><span class=lnt id=hl-111-3><a class=lnlinks href=#hl-111-3>3</a>
</span><span class=lnt id=hl-111-4><a class=lnlinks href=#hl-111-4>4</a>
</span><span class=lnt id=hl-111-5><a class=lnlinks href=#hl-111-5>5</a>
</span><span class=lnt id=hl-111-6><a class=lnlinks href=#hl-111-6>6</a>
</span><span class=lnt id=hl-111-7><a class=lnlinks href=#hl-111-7>7</a>
</span><span class=lnt id=hl-111-8><a class=lnlinks href=#hl-111-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordertotals</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordertotals</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>SAVEPOINT</span><span class=w> </span><span class=n>rollback1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordertotals</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>SAVEPOINT</span><span class=w> </span><span class=n>rollback2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ROLLBACK</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>rollback1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>ordertotals</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>更改默认的提交行为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-112-1><a class=lnlinks href=#hl-112-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=n>autocommit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/mysql/>MySQL</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/classicpapertranslation/resnet/><span class=title>« Prev</span><br><span>ResNet</span>
</a><a class=next href=http://localhost:1313/posts/classicpapertranslation/vgg/><span class=title>Next »</span><br><span>VGG</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>KurongBlog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>