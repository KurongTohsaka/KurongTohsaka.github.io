---
title: "《深入理解设计模式》记录"
date: 2025-03-02
aliases: ["/Daliy Dev"]
tags: ["Design Pattern"]
categories: ["Daliy Dev"]
author: "Kurong"
showToc: true
TocOpen: true
draft: false
hidemeta: false
comments: false
description: ""
disableHLJS: false # to disable highlightjs
disableShare: true
disableHLJS: false
hideSummary: false
searchHidden: true
ShowBreadCrumbs: true
ShowPostNavLinks: true
ShowRssButtonInSectionTermList: true
UseHugoToc: true
---

# 《深入理解设计模式》记录

## 单例模式

单例模式（Singleton Pattern）是一种创建型设计模式，其核心目标是确保一个类仅有一个实例，并提供全局访问点。它适用于需要全局唯一对象且频繁访问的场景，例如配置管理、线程池、日志记录器等。

单例模式需要注意三点：

- 私有化构造函数：防止外部通过 `new` 直接创建实例。
- 自行创建实例：类内部负责生成唯一实例。
- 全局访问方法：提供静态方法供外部获取实例。

### 懒汉模式

特点：延迟实例化，首次调用时创建实例，需处理线程安全问题。

```go
package singleton

import "sync"

type lazySingleton struct {
  
}

var (
	instance *lazySingleton
  once sync.Once
)

func GetLazyInstance() *lazySingleton {
  once.Do(func() {
    instance = &lazySingleton{}
  })
  return instance
}
```

### 饿汉模式

特点：在包加载时直接初始化实例，无需考虑线程安全。

```go
package singleton

type eagerSingleton struct {

}

var instance = &eagerSingleton{}

func GetEagerInstance() *eagerSingleton {
    return instance
}
```

### 懒汉模式的另一实现形式：静态内部类

特点：通过嵌套结构体延迟加载，结合 `sync.Once` 实现线程安全。

```go
package singleton

import "sync"

type holderSingleton struct {

}

var (
    holderInstance *holderSingleton
    holderOnce     sync.Once
)

// 嵌套结构体（模拟静态内部类）
type holder struct{}

func (h *holder) getInstance() *holderSingleton {
    holderOnce.Do(func() {
        holderInstance = &holderSingleton{}
    })
    return holderInstance
}

// GetHolderInstance 对外暴露访问方法
func GetHolderInstance() *holderSingleton {
    return (&holder{}).getInstance()
}
```

### 枚举类

特点：利用 Go 的 `init` 函数和常量模拟枚举单例。

```go
package singleton

type enumSingleton struct {
    // 定义单例结构体字段
}

const (
    InstanceKey = "singleton"
)

var instances = make(map[string]interface{})

func init() {
    instances[InstanceKey] = &enumSingleton{}
}

// GetEnumInstance 通过键名获取单例
func GetEnumInstance() *enumSingleton {
    return instances[InstanceKey].(*enumSingleton)
}
```

